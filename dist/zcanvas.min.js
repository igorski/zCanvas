(()=>{"use strict";function t(){this._eventMappings=[],this._disposed=!1}const e=t;t.prototype.add=function(t,e,i){return!this.has(t,e)&&(t.addEventListener(e,i,!1),this._eventMappings.push({element:t,type:e,listener:i}),!0)},t.prototype.has=function(t,e){for(var i=this._eventMappings.length;i--;){var n=this._eventMappings[i];if(n.element===t&&n.type==e)return!0}return!1},t.prototype.remove=function(t,e){for(var i=this._eventMappings.length;i--;){var n=this._eventMappings[i];if(n.element===t&&n.type===e)return t.removeEventListener(e,n.listener,!1),this._eventMappings.splice(i,1),!0}return!1},t.prototype.dispose=function(){if(!this._disposed){this._disposed=!0;for(var t=this._eventMappings.length;t--;){var e=this._eventMappings[t];this.remove(e.element,e.type)}this._eventMappings=null}};var i={extend:function(t,e){function n(){}n.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.super=function(t,i,n){for(var o=new Array(arguments.length-2),s=2;s<arguments.length;s++)o[s-2]=arguments[s];return e.prototype[i].apply(t,o)},t.extend=function(e){i.extend(e,t)}}};const n=i;var o=Math.min,s=Math.max,r=Math.round,h=60;function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,i=void 0===e?300:e,n=t.height,o=void 0===n?300:n,s=t.fps,r=void 0===s?h:s,a=t.scale,d=void 0===a?1:a,l=t.backgroundColor,p=void 0===l?null:l,u=t.animate,c=void 0!==u&&u,f=t.smoothing,_=void 0===f||f,g=t.stretchToFit,v=void 0!==g&&g,m=t.viewport,w=void 0===m?null:m,y=t.handler,b=void 0===y?null:y,C=t.preventEventBubbling,x=void 0!==C&&C,I=t.parentElement,E=void 0===I?null:I,H=t.debug,R=void 0!==H&&H,S=t.onUpdate,P=void 0===S?null:S;if(i<=0||o<=0)throw new Error("cannot construct a zCanvas without valid dimensions");this.DEBUG=R,this._smoothing=_,this._updateHandler=P,this._renderHandler=this.render.bind(this),this._lastRender=0,this._renderId=0,this._renderPending=!1,this._disposed=!1,this._scale={x:d,y:d},this._handler=b,this._activeTouches=[],this._children=[],this.setFrameRate(r),this.setAnimatable(c),this._element=document.createElement("canvas"),this._canvasContext=this._element.getContext("2d"),p&&this.setBackgroundColor(p);var k=this._canvasContext,B=window.devicePixelRatio||1,M=k.webkitBackingStorePixelRatio||k.mozBackingStorePixelRatio||k.msBackingStorePixelRatio||k.oBackingStorePixelRatio||k.backingStorePixelRatio||1,T=B/M;this._HDPIscaleRatio=B!==M?T:1,this.setDimensions(i,o,!0,!0),w&&this.setViewport(w.width,w.height),1!==d&&this.scale(d,d),v&&this.stretchToFit(!0),E instanceof Element&&this.insertInPage(E),this.setSmoothing(_),this.preventEventBubbling(x),this.addListeners(),this._animate&&this.render()}function d(t){var e,i,n=t._HDPIscaleRatio,s=t._viewport;if(t._enqueuedSize){var r=t._enqueuedSize;e=r.width,i=r.height,t._enqueuedSize=null,t._width=e,t._height=i}if(s){var h=t._width,a=t._height;e=o(s.width,h),i=o(s.height,a)}if(e&&i){var d=t._element;d.width=e*n,d.height=i*n,d.style.width="".concat(e,"px"),d.style.height="".concat(i,"px")}t._canvasContext.scale(n,n),!1===t._smoothing&&t.setSmoothing(!1)}a.extend=function(t){n.extend(t,a)},a.prototype.insertInPage=function(t){if(this._element.parentNode)throw new Error("Canvas already present in DOM");t.appendChild(this._element)},a.prototype.getElement=function(){return this._element},a.prototype.preventEventBubbling=function(t){this._preventDefaults=t},a.prototype.addChild=function(t){if(this.contains(t))return this;var e=this._children.length;return e>0&&(t.last=this._children[e-1],t.last.next=t),t.next=null,t.setCanvas(this),t.setParent(this),this._children.push(t),this.invalidate(),this},a.prototype.removeChild=function(t){t.setParent(null),t.setCanvas(null);var e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1);var i=t.last,n=t.next;return i&&(i.next=n),n&&(n.last=i),t.last=t.next=null,this.invalidate(),t},a.prototype.getChildAt=function(t){return this._children[t]},a.prototype.removeChildAt=function(t){return this.removeChild(this.getChildAt(t))},a.prototype.numChildren=function(){return this._children.length},a.prototype.getChildren=function(){return this._children},a.prototype.contains=function(t){return t._parent===this},a.prototype.invalidate=function(){this._animate||this._renderPending||(this._renderPending=!0,this._renderId=window.requestAnimationFrame(this._renderHandler))},a.prototype.getFrameRate=function(){return this._fps},a.prototype.setFrameRate=function(t){this._fps=t,this._aFps=t,this._renderInterval=1e3/t},a.prototype.getActualFrameRate=function(){return this._aFps},a.prototype.getRenderInterval=function(){return this._renderInterval},a.prototype.setSmoothing=function(t){this._smoothing=t;var e=this._element.style,i=this._canvasContext;["imageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","webkitImageSmoothingEnabled"].forEach((function(e){void 0!==i[e]&&(i[e]=t)})),["-moz-crisp-edges","-webkit-crisp-edges","pixelated","crisp-edges"].forEach((function(i){e["image-rendering"]=t?void 0:i})),this.invalidate()},a.prototype.getWidth=function(){return this._enqueuedSize?this._enqueuedSize.width:this._width},a.prototype.getHeight=function(){return this._enqueuedSize?this._enqueuedSize.height:this._height},a.prototype.setDimensions=function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._enqueuedSize={width:t,height:e},!0===i&&(this._preferredWidth=t,this._preferredHeight=e),!0===n&&d(this),this.invalidate()},a.prototype.setViewport=function(t,e){this._viewport={width:t,height:e},this.panViewport(0,0),d(this)},a.prototype.panViewport=function(t,e){var i,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this._viewport;r.left=s(0,o(t,this._width-r.width)),r.right=r.left+r.width,r.top=s(0,o(e,this._height-r.height)),r.bottom=r.top+r.height,this.invalidate(),n&&(null===(i=this._handler)||void 0===i||i.call(this,{type:"panned",value:r}))},a.prototype.setBackgroundColor=function(t){this._bgColor=t},a.prototype.setAnimatable=function(t){var e;this._animate,this._animate=t,this._lastRaf=(null===(e=window.performance)||void 0===e?void 0:e.now())||Date.now(),t&&!this._renderPending&&this._renderHandler(this._lastRaf)},a.prototype.isAnimatable=function(){return this._animate},a.prototype.drawImage=function(t,e,i,n,s,r,h,a,d){if(e=.5+e<<0,i=.5+i<<0,s=.5+s<<0,!((n=.5+n<<0)<=0||s<=0)){var l=this._canvasContext;if("number"==typeof r){var p=(n=o(l.canvas.width,n))/a,u=(s=o(l.canvas.height,s))/d;r+a>t.width&&(n-=p*(r+a-t.width),a-=r+a-t.width),h+d>t.height&&(s-=u*(h+d-t.height),d-=h+d-t.height),l.drawImage(t,r,h,a,d,e,i,n,s)}else l.drawImage(t,e,i,n,s)}},a.prototype.scale=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;this._scale={x:t,y:e};var i=1===t&&1===e?"":"scale(".concat(t,", ").concat(e,")"),n=this._element.style;n["-webkit-transform-origin"]=n["transform-origin"]="0 0",n["-webkit-transform"]=n.transform=i,this.invalidate()},a.prototype.stretchToFit=function(t){this._stretchToFit=t;var e=window,i=e.innerWidth,n=e.innerHeight,o=this._preferredWidth,s=this._preferredHeight,h=1,a=1;n>i?(h=i/o,a=n/(s=t?n/i*o:s)):(h=i/(o=t?i/n*s:o),a=n/s),this.setDimensions(r(o),r(s),!1,!0),this.scale(h,a)},a.prototype.dispose=function(){if(!this._disposed){this._animate=!1,window.cancelAnimationFrame(this._renderId),this.removeListeners();for(var t=this.numChildren();t--;)this._children[t].dispose();this._children=[],this._element.parentNode&&this._element.parentNode.removeChild(this._element),this._disposed=!0}},a.prototype.handleInteraction=function(t){var e,i,n=this._children.length,o=this._viewport;if(n>0)switch(i=this._children[n-1],t.type){default:var s=0,r=0,h=t.changedTouches,a=0,d=h.length;if(d>0){var l=this.getCoordinate();for(o&&(l.x-=o.left,l.y-=o.top),a=0;a<d;++a){var p=h[a],u=p.identifier;if(s=p.pageX-l.x,r=p.pageY-l.y,"touchstart"===t.type){for(;i;){if(!this._activeTouches.includes(i)&&i.handleInteraction(s,r,t)){this._activeTouches[u]=i;break}i=i.last}i=this._children[n-1]}else(null===(e=i=this._activeTouches[u])||void 0===e?void 0:e.handleInteraction(s,r,t))&&"touchmove"!==t.type&&(this._activeTouches[u]=null)}}break;case"mousedown":case"mousemove":case"mouseup":var c=t.offsetX,f=t.offsetY;for(o&&(c+=o.left,f+=o.top);i&&!i.handleInteraction(c,f,t);)i=i.last;break;case"wheel":var _=t.deltaX,g=t.deltaY,v=0===_?0:_>0?20:-20,m=0===g?0:g>0?20:-20;this.panViewport(o.left+v,o.top+m,!0)}this._preventDefaults&&(t.stopPropagation(),t.preventDefault()),this._animate||this.invalidate()},a.prototype.render=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._renderPending=!1;var e,i=t-this._lastRender;if(this._animate&&i/this._renderInterval<.999)return this._renderId=window.requestAnimationFrame(this._renderHandler),void(this._lastRaf=t);this._aFps=1e3/(t-this._lastRaf),e=this._fps>h?this._fps/this._aFps:this._fps===h&&this._aFps>63?1:1/(this._fps/this._aFps),this._lastRaf=t,this._lastRender=t-i%this._renderInterval,this._enqueuedSize&&d(this);var n,o=this._canvasContext;if(o){var s=this._width,r=this._height;this._bgColor?(o.fillStyle=this._bgColor,o.fillRect(0,0,s,r)):o.clearRect(0,0,s,r);var a="function"==typeof this._updateHandler;for(a&&this._updateHandler(t,e),n=this._children[0];n;)a||n.update(t,e),n.draw(o,this._viewport),n=n.next}!this._disposed&&this._animate&&(this._renderPending=!0,this._renderId=window.requestAnimationFrame(this._renderHandler))},a.prototype.addListeners=function(){var t=this;this._eventHandler||(this._eventHandler=new e);var i=this._eventHandler,n=this.handleInteraction.bind(this),o=this._element;"ontouchstart"in window&&["start","move","end","cancel"].forEach((function(t){i.add(o,"touch".concat(t),n)})),["down","move"].forEach((function(t){i.add(o,"mouse".concat(t),n)})),i.add(window,"mouseup",n),this._viewport&&i.add(o,"wheel",n),this._stretchToFit&&i.add(window,"resize",(function(){t.stretchToFit(t._stretchToFit)}))},a.prototype.removeListeners=function(){this._eventHandler&&this._eventHandler.dispose(),this._eventHandler=null},a.prototype.getCoordinate=function(){for(var t=0,e=0,i=this._element;i.offsetParent;)t+=i.offsetLeft,e+=i.offsetTop,i=i.offsetParent;return{x:t+=i.offsetLeft,y:e+=i.offsetTop}};var l={loadImage:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,o){var s=i||new window.Image,r=c(t),h=new e;r||(u(t,s),h.add(s,"load",(function(){h.dispose(),l.onReady(s).then((function(t){return n(f(s))})).catch(o)})),h.add(s,"error",(function(t){h.dispose(),o(t)}))),s.src=t,r&&l.onReady(s).then((function(t){return n(f(s))})).catch(o)}))},isReady:function(t){return!0===t.complete&&"number"==typeof t.naturalWidth&&t.naturalWidth>0},onReady:function(t){return new Promise((function(e,i){var n=0;!function o(){l.isReady(t)?e():60==++n?i(new Error("Image could not be resolved. This shouldn't occur.")):window.requestAnimationFrame(o)}()}))}};const p=l;function u(t,e){var i,n;i=t,n=window.location,i.startsWith("./")||i.startsWith("".concat(n.protocol,"//").concat(n.host))||!/^http[s]?:/.test(i)||(e.crossOrigin="Anonymous")}function c(t){var e=("string"==typeof t?t:t.src).substr(0,5);return"data:"===e||"blob:"===e}function f(t){var e={image:t,size:null};return t instanceof window.HTMLImageElement&&(e.size=function(t){return{width:t.width||t.naturalWidth,height:t.height||t.naturalHeight}}(t)),e}var _=function(t,e){var i=t.left,n=t.top;return i+t.width>=e.left&&i<=e.right&&n+t.height>=e.top&&n<=e.bottom},g=function(t,e){var i=t.left,n=t.top,o=t.width,s=t.height,r=e.left,h=e.top,a=e.width,d=e.height;return{src:{left:i>r?0:r-i,top:n>h?0:h-n,width:o=i>r?Math.min(o,a-(i-r)):Math.min(a,o-(r-i)),height:s=n>h?Math.min(s,d-(n-h)):Math.min(d,s-(h-n))},dest:{left:i>r?i-r:0,top:n>h?n-h:0,width:o,height:s}}},v=Math.min,m=Math.max,w=.5;function y(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,i=t.height,n=t.x,o=void 0===n?0:n,s=t.y,r=void 0===s?0:s,h=t.bitmap,a=void 0===h?null:h,d=t.collidable,l=void 0!==d&&d,p=t.interactive,u=void 0!==p&&p,c=t.mask,f=void 0!==c&&c,_=t.sheet,g=void 0===_?[]:_,v=t.sheetTileWidth,m=void 0===v?0:v,w=t.sheetTileHeight,y=void 0===w?0:w;if(e<=0||i<=0)throw new Error("cannot construct a zSprite without valid dimensions");if(this._children=[],this._disposed=!1,this.collidable=l,this.hover=!1,this._mask=f,this._bounds={left:0,top:0,width:e,height:i},this._parent=null,this.last=null,this.next=null,this.canvas=null,this._bitmap,this._bitmapReady=!1,this._draggable=!1,this._keepInBounds=!1,this.isDragging=!1,this.setX(o),this.setY(r),this.setInteractive(u),a&&this.setBitmap(a),Array.isArray(g)&&g.length>0){if(!a)throw new Error("cannot use a spritesheet without a valid Bitmap");this.setSheet(g,m,y)}}y.extend=function(t){n.extend(t,y)},y.prototype.getDraggable=function(){return this._draggable},y.prototype.setDraggable=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._draggable=t,this._keepInBounds=!!this._constraint||e,t&&!this._interactive&&this.setInteractive(!0)},y.prototype.getX=function(){return this._bounds.left},y.prototype.setX=function(t){var e=t-this._bounds.left;this._bounds.left=this._constraint?t+this._constraint.left:t;for(var i=this._children[0];i;)i.isDragging||i.setX(i._bounds.left+e),i=i.next},y.prototype.getY=function(){return this._bounds.top},y.prototype.setY=function(t){var e=t-this._bounds.top;this._bounds.top=this._constraint?t+this._constraint.top:t;for(var i=this._children[0];i;)i.isDragging||i.setY(i._bounds.top+e),i=i.next},y.prototype.getWidth=function(){return this._bounds.width},y.prototype.setWidth=function(t){var e=this._bounds.width||0;this._bounds.width=t,0!==e&&(this._bounds.left-=t*w-e*w),this.invalidate()},y.prototype.getHeight=function(){return this._bounds.height},y.prototype.setHeight=function(t){var e=this._bounds.height||0;this._bounds.height=t,0!==e&&(this._bounds.top-=t*w-e*w),this.invalidate()},y.prototype.setBounds=function(t,e,i,n){if(this._constraint)t-=this._constraint.left,e-=this._constraint.top;else if(!this.canvas)throw new Error("cannot update position of a Sprite that has no constraint or is not added to a canvas");"number"==typeof i&&(this._bounds.width=i),"number"==typeof n&&(this._bounds.height=n);var o=this._bounds.width,s=this._bounds.height,r=this._constraint?this._constraint.width:this.canvas.width,h=this._constraint?this._constraint.height:this.canvas.height;if(this._keepInBounds){var a=v(0,-(o-r)),d=v(0,-(s-h)),l=h-s;t=v(r-o,m(t,a)),e=v(l,m(e,d))}else t>r&&(t+=o*w),e>h&&(e+=s*w);this.setX(t),this.setY(e)},y.prototype.getBounds=function(){return this._bounds},y.prototype.getInteractive=function(){return this._interactive},y.prototype.setInteractive=function(t){this._interactive=t},y.prototype.update=function(t,e){for(var i=this._children[0];i;)i.update(t),i=i.next;this._animation&&this.updateAnimation(e)},y.prototype.draw=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.canvas){var i=this._bounds,n=this._bitmapReady;if(n&&e&&(n=_(i,e)),t.save(),this._mask&&(t.globalCompositeOperation="destination-in"),n){var o=this._animation,s=i.left,r=i.top,h=i.width,a=i.height;if(o){var d=o.tileWidth?o.tileWidth:w+h<<0,l=o.tileHeight?o.tileHeight:w+a<<0;e&&(s-=e.left,r-=e.top),t.drawImage(this._bitmap,o.col*d,o.type.row*l,d,l,w+s<<0,w+r<<0,w+h<<0,w+a<<0)}else if(e){var p=g(i,e),u=p.src,c=p.dest;t.drawImage(this._bitmap,w+u.left<<0,w+u.top<<0,w+u.width<<0,w+u.height<<0,w+c.left<<0,w+c.top<<0,w+c.width<<0,w+c.height<<0)}else t.drawImage(this._bitmap,w+s<<0,w+r<<0,w+h<<0,w+a<<0)}for(var f=this._children[0];f;)f.draw(t,e),f=f.next;this._mask&&(t.globalCompositeOperation="source-over"),t.restore(),this.canvas.DEBUG&&this.drawOutline(t)}},y.prototype.insideBounds=function(t,e){var i=this._bounds,n=i.left,o=i.top,s=i.width,r=i.height;return t>=n&&t<=n+s&&e>=o&&e<=o+r},y.prototype.collidesWith=function(t){if(t===this)return!1;var e=this._bounds,i=t.getBounds();return!(e.top+e.height<i.top||e.top>i.top+i.height||e.left+e.width<i.left||e.left>i.left+i.width)},y.prototype.getIntersection=function(t){if(this.collidesWith(t)){var e=this._bounds,i=t.getBounds(),n=m(e.left,i.left),o=m(e.top,i.top);return{left:n,top:o,width:v(e.left+e.width,i.width+i.height)-n,height:v(e.top+e.height,i.top+i.height)-o}}return null},y.prototype.collidesWithEdge=function(t,e){if(t===this)return!1;if(isNaN(e)||e<0||e>3)throw new Error("invalid argument for edge");switch(e){case 0:return this.getX()<=t.getX()+t.getWidth();case 1:return this.getY()<=t.getY()+t.getHeight();case 2:return this.getX()+this.getWidth()<=t.getX();case 3:return this.getY()+this.getHeight()>=t.getY()}return!1},y.prototype.getBitmap=function(){return this._bitmap},y.prototype.setBitmap=function(t,e,i){var n=this,o=t instanceof window.HTMLCanvasElement,s=t instanceof window.HTMLImageElement;if(t&&!o&&!s&&"string"!=typeof t)throw new Error('expected HTMLImageElement, HTMLCanvasElement or String for Image source, got "'.concat(t,'" instead'));return new Promise((function(r,h){if(n._bitmap!==t&&(n._bitmapReady=!1),t){var a="number"==typeof e,d="number"==typeof i;if(a&&n.setWidth(e),d&&n.setHeight(i),n._keepInBounds&&n.canvas&&(a||d)){var l=-(n._bounds.width-n.canvas.getWidth()),u=-(n._bounds.height-n.canvas.getHeight());n._bounds.left>0?n._bounds.left=0:n._bounds.left<l&&(n._bounds.left=l),n._bounds.top>0?n._bounds.top=0:n._bounds.top<u&&(n._bounds.top=u)}if(o)return n._bitmap=t,n._bitmapReady=!0,r();p.loadImage(s?t.src:t,s?t:null).then((function(t){var e=t.size,i=t.image;n._bitmap=i,n._bitmapReady=!0,n._bitmapWidth=e.width,n._bitmapHeight=e.height,n.invalidate(),r()})).catch((function(t){h(new Error('zSprite.setBitmap() "'.concat(null==t?void 0:t.message,'" occurred.')))}))}else n._bitmap=null}))},y.prototype.setSheet=function(t,e,i){this._sheet=t,t?(this._animation={type:null,col:0,maxCol:0,fpt:0,counter:0},"number"==typeof e&&(this._animation.tileWidth=e),"number"==typeof i&&(this._animation.tileHeight=i),this.switchAnimation(0)):this._animation=null},y.prototype.switchAnimation=function(t){var e=this._animation,i=this._sheet[t];e.type=i,e.fpt=i.fpt,e.maxCol=i.col+(i.amount-1),e.col=i.col,e.counter=0,e.onComplete=i.onComplete},y.prototype.setParent=function(t){this._parent=t},y.prototype.getParent=function(){return this._parent},y.prototype.setCanvas=function(t){this.canvas=t,this._children.forEach((function(e){e.setCanvas(t)}))},y.prototype.setConstraint=function(t,e,i,n){return this._constraint={left:t,top:e,width:i,height:n},this._bounds.left=m(t,this._bounds.left),this._bounds.top=m(e,this._bounds.top),this._keepInBounds=!0,this.getConstraint()},y.prototype.getConstraint=function(){return this._constraint},y.prototype.addChild=function(t){if(this.contains(t))return this;var e=this._children.length;return e>0&&(t.last=this._children[e-1],t.last.next=t,t.next=null),t.setCanvas(this.canvas),t.setParent(this),this._children.push(t),this.invalidate(),this},y.prototype.removeChild=function(t){t.setParent(null),t.setCanvas(null);var e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1);var i=t.last,n=t.next;return i&&(i.next=n),n&&(n.last=i),t.last=t.next=null,this.invalidate(),t},y.prototype.getChildAt=function(t){return this._children[t]},y.prototype.removeChildAt=function(t){return this.removeChild(this.getChildAt(t))},y.prototype.numChildren=function(){return this._children.length},y.prototype.getChildren=function(){return this._children},y.prototype.contains=function(t){return t._parent===this},y.prototype.dispose=function(){if(!this._disposed){this._disposed=!0,this._parent&&this._parent.removeChild(this);for(var t=this._children.length;t--;){var e=this._children[t];e.dispose(),e.next=null,e.last=null}this._children=[]}},y.prototype.handlePress=function(t,e,i){},y.prototype.handleRelease=function(t,e,i){},y.prototype.handleClick=function(){},y.prototype.handleMove=function(t,e,i){var n=this._dragStartOffset.x+(t-this._dragStartEventCoordinates.x),o=this._dragStartOffset.y+(e-this._dragStartEventCoordinates.y);this.setBounds(n,o,this._bounds.width,this._bounds.height)},y.prototype.handleInteraction=function(t,e,i){var n,o=this._children.length;if(o>0)for(n=this._children[o-1];n;){if(n.handleInteraction(t,e,i))return!0;n=n.last}if(!this._interactive)return!1;var s=i.type;if(this._pressed&&("touchend"===s||"mouseup"===s))return this._pressed=!1,this.isDragging&&(this.isDragging=!1),Date.now()-this._pressTime<250&&this.handleClick(),this.handleRelease(t,e,i),!0;if(this.insideBounds(t,e)){if(this.hover=!0,"touchstart"===s||"mousedown"===s)return this._pressTime=Date.now(),this._pressed=!0,this._draggable&&(this.isDragging=!0,this._dragStartOffset={x:this._bounds.left,y:this._bounds.top},this._dragStartEventCoordinates={x:t,y:e}),this.handlePress(t,e,i),"touchstart"===s&&(i.stopPropagation(),i.preventDefault()),!0}else this.hover=!1;return!!this.isDragging&&(this.handleMove(t,e,i),!0)},y.prototype.updateAnimation=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this._animation;e.counter+=t,e.counter>=e.fpt&&(++e.col,e.counter=e.counter%e.fpt),e.col>e.maxCol&&(e.col=e.type.col,"function"==typeof e.onComplete&&e.onComplete(this))},y.prototype.invalidate=function(){this.canvas&&this.canvas.invalidate()},y.prototype.drawOutline=function(t){t.lineWidth=1,t.strokeStyle="#FF0000",t.strokeRect(this.getX(),this.getY(),this.getWidth(),this.getHeight())},document.createElement("canvas").getContext("2d"),new Map})();