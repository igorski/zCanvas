define((()=>(()=>{"use strict";var t={d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function i(){this._eventMappings=[],this._disposed=!1}t.r(e),t.d(e,{canvas:()=>p,collision:()=>D,loader:()=>f,sprite:()=>I});const n=i;i.prototype.add=function(t,e,i){return!this.has(t,e)&&(t.addEventListener(e,i,!1),this._eventMappings.push({element:t,type:e,listener:i}),!0)},i.prototype.has=function(t,e){for(var i=this._eventMappings.length;i--;){var n=this._eventMappings[i];if(n.element===t&&n.type==e)return!0}return!1},i.prototype.remove=function(t,e){for(var i=this._eventMappings.length;i--;){var n=this._eventMappings[i];if(n.element===t&&n.type===e)return t.removeEventListener(e,n.listener,!1),this._eventMappings.splice(i,1),!0}return!1},i.prototype.dispose=function(){if(!this._disposed){this._disposed=!0;for(var t=this._eventMappings.length;t--;){var e=this._eventMappings[t];this.remove(e.element,e.type)}this._eventMappings=null}};var o={extend:function(t,e){function i(){}i.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.super=function(t,i,n){for(var o=new Array(arguments.length-2),s=2;s<arguments.length;s++)o[s-2]=arguments[s];return e.prototype[i].apply(t,o)},t.extend=function(e){o.extend(e,t)}}};const s=o;var r=Math.min,h=Math.max,a=Math.round,d=60;function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,i=void 0===e?300:e,n=t.height,o=void 0===n?300:n,s=t.fps,r=void 0===s?d:s,h=t.scale,a=void 0===h?1:h,l=t.backgroundColor,p=void 0===l?null:l,u=t.animate,c=void 0!==u&&u,f=t.smoothing,g=void 0===f||f,_=t.stretchToFit,v=void 0!==_&&_,m=t.viewport,w=void 0===m?null:m,y=t.handler,b=void 0===y?null:y,C=t.preventEventBubbling,x=void 0!==C&&C,I=t.parentElement,E=void 0===I?null:I,H=t.debug,S=void 0!==H&&H,R=t.onUpdate,P=void 0===R?null:R;if(i<=0||o<=0)throw new Error("cannot construct a zCanvas without valid dimensions");this.DEBUG=S,this._smoothing=g,this._updateHandler=P,this._renderHandler=this.render.bind(this),this._lastRender=0,this._renderId=0,this._renderPending=!1,this._disposed=!1,this._scale={x:a,y:a},this._handler=b,this._activeTouches=[],this._children=[],this._coords=null,this.setFrameRate(r),this.setAnimatable(c),this._element=document.createElement("canvas"),this._canvasContext=this._element.getContext("2d"),p&&this.setBackgroundColor(p);var M=this._canvasContext,B=window.devicePixelRatio||1,k=M.webkitBackingStorePixelRatio||M.mozBackingStorePixelRatio||M.msBackingStorePixelRatio||M.oBackingStorePixelRatio||M.backingStorePixelRatio||1,D=B/k;this._HDPIscaleRatio=B!==k?D:1,this.setDimensions(i,o,!0,!0),w&&this.setViewport(w.width,w.height),1!==a&&this.scale(a,a),v&&this.stretchToFit(!0),E instanceof Element&&this.insertInPage(E),this.setSmoothing(g),this.preventEventBubbling(x),this.addListeners(),this._animate&&this.render()}const p=l;function u(t){var e,i,n=t._HDPIscaleRatio,o=t._viewport;if(t._enqueuedSize){var s=t._enqueuedSize;e=s.width,i=s.height,t._enqueuedSize=null,t._width=e,t._height=i}if(o){var h=t._width,a=t._height;e=r(o.width,h),i=r(o.height,a)}if(e&&i){var d=t._element;d.width=e*n,d.height=i*n,d.style.width="".concat(e,"px"),d.style.height="".concat(i,"px")}t._canvasContext.scale(n,n),!1===t._smoothing&&t.setSmoothing(!1),t._coords=null}l.extend=function(t){s.extend(t,l)},l.prototype.insertInPage=function(t){if(this._element.parentNode)throw new Error("Canvas already present in DOM");t.appendChild(this._element)},l.prototype.getElement=function(){return this._element},l.prototype.preventEventBubbling=function(t){this._preventDefaults=t},l.prototype.addChild=function(t){if(this.contains(t))return this;var e=this._children.length;return e>0&&(t.last=this._children[e-1],t.last.next=t),t.next=null,t.setCanvas(this),t.setParent(this),this._children.push(t),this.invalidate(),this},l.prototype.removeChild=function(t){t.setParent(null),t.setCanvas(null);var e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1);var i=t.last,n=t.next;return i&&(i.next=n),n&&(n.last=i),t.last=t.next=null,this.invalidate(),t},l.prototype.getChildAt=function(t){return this._children[t]},l.prototype.removeChildAt=function(t){return this.removeChild(this.getChildAt(t))},l.prototype.numChildren=function(){return this._children.length},l.prototype.getChildren=function(){return this._children},l.prototype.contains=function(t){return t._parent===this},l.prototype.invalidate=function(){this._animate||this._renderPending||(this._renderPending=!0,this._renderId=window.requestAnimationFrame(this._renderHandler))},l.prototype.getFrameRate=function(){return this._fps},l.prototype.setFrameRate=function(t){this._fps=t,this._aFps=t,this._renderInterval=1e3/t},l.prototype.getActualFrameRate=function(){return this._aFps},l.prototype.getRenderInterval=function(){return this._renderInterval},l.prototype.setSmoothing=function(t){this._smoothing=t;var e=this._element.style,i=this._canvasContext;["imageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","webkitImageSmoothingEnabled"].forEach((function(e){void 0!==i[e]&&(i[e]=t)})),["-moz-crisp-edges","-webkit-crisp-edges","pixelated","crisp-edges"].forEach((function(i){e["image-rendering"]=t?void 0:i})),this.invalidate()},l.prototype.getWidth=function(){return this._enqueuedSize?this._enqueuedSize.width:this._width},l.prototype.getHeight=function(){return this._enqueuedSize?this._enqueuedSize.height:this._height},l.prototype.setDimensions=function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._enqueuedSize={width:t,height:e},!0===i&&(this._preferredWidth=t,this._preferredHeight=e),!0===n&&u(this),this.invalidate()},l.prototype.setViewport=function(t,e){this._viewport={width:t,height:e},this.panViewport(0,0),u(this)},l.prototype.panViewport=function(t,e){var i,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=this._viewport;o.left=h(0,r(t,this._width-o.width)),o.right=o.left+o.width,o.top=h(0,r(e,this._height-o.height)),o.bottom=o.top+o.height,this.invalidate(),n&&(null===(i=this._handler)||void 0===i||i.call(this,{type:"panned",value:o}))},l.prototype.setBackgroundColor=function(t){this._bgColor=t},l.prototype.setAnimatable=function(t){var e;this._animate,this._animate=t,this._lastRaf=(null===(e=window.performance)||void 0===e?void 0:e.now())||Date.now(),t&&!this._renderPending&&this._renderHandler(this._lastRaf)},l.prototype.isAnimatable=function(){return this._animate},l.prototype.drawImage=function(t,e,i,n,o,s,h,a,d){if(e=.5+e<<0,i=.5+i<<0,o=.5+o<<0,!((n=.5+n<<0)<=0||o<=0)){var l=this._canvasContext;if("number"==typeof s){var p=(n=r(l.canvas.width,n))/a,u=(o=r(l.canvas.height,o))/d;s+a>t.width&&(n-=p*(s+a-t.width),a-=s+a-t.width),h+d>t.height&&(o-=u*(h+d-t.height),d-=h+d-t.height),l.drawImage(t,s,h,a,d,e,i,n,o)}else l.drawImage(t,e,i,n,o)}},l.prototype.scale=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;this._scale={x:t,y:e};var i=1===t&&1===e?"":"scale(".concat(t,", ").concat(e,")"),n=this._element.style;n["-webkit-transform-origin"]=n["transform-origin"]="0 0",n["-webkit-transform"]=n.transform=i,this.invalidate()},l.prototype.stretchToFit=function(t){this._stretchToFit=t;var e=window,i=e.innerWidth,n=e.innerHeight,o=this._preferredWidth,s=this._preferredHeight,r=1,h=1;n>i?(r=i/o,h=n/(s=t?n/i*o:s)):(r=i/(o=t?i/n*s:o),h=n/s),this.setDimensions(a(o),a(s),!1,!0),this.scale(r,h)},l.prototype.dispose=function(){if(!this._disposed){this._animate=!1,window.cancelAnimationFrame(this._renderId),this.removeListeners();for(var t=this.numChildren();t--;)this._children[t].dispose();this._children=[],this._element.parentNode&&this._element.parentNode.removeChild(this._element),this._disposed=!0}},l.prototype.handleInteraction=function(t){var e,i,n=this._children.length,o=this._viewport;if(n>0)switch(i=this._children[n-1],t.type){default:var s=0,r=0,h=t.changedTouches,a=0,d=h.length;if(d>0){var l=this.getCoordinate(),p=l.x,u=l.y;for(o&&(p-=o.left,u-=o.top),a=0;a<d;++a){var c=h[a],f=c.identifier;if(s=c.pageX-p,r=c.pageY-u,"touchstart"===t.type){for(;i;){if(!this._activeTouches.includes(i)&&i.handleInteraction(s,r,t)){this._activeTouches[f]=i;break}i=i.last}i=this._children[n-1]}else(null===(e=i=this._activeTouches[f])||void 0===e?void 0:e.handleInteraction(s,r,t))&&"touchmove"!==t.type&&(this._activeTouches[f]=null)}}break;case"mousedown":case"mousemove":case"mouseup":var g=t.offsetX,_=t.offsetY;for(o&&(g+=o.left,_+=o.top);i&&!i.handleInteraction(g,_,t);)i=i.last;break;case"wheel":var v=t.deltaX,m=t.deltaY,w=0===v?0:v>0?20:-20,y=0===m?0:m>0?20:-20;this.panViewport(o.left+w,o.top+y,!0)}this._preventDefaults&&(t.stopPropagation(),t.preventDefault()),this._animate||this.invalidate()},l.prototype.render=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._renderPending=!1;var e,i=t-this._lastRender;if(this._animate&&i/this._renderInterval<.999)return this._renderId=window.requestAnimationFrame(this._renderHandler),void(this._lastRaf=t);this._aFps=1e3/(t-this._lastRaf),e=this._fps>d?this._fps/this._aFps:this._fps===d&&this._aFps>63?1:1/(this._fps/this._aFps),this._lastRaf=t,this._lastRender=t-i%this._renderInterval,this._enqueuedSize&&u(this);var n,o=this._canvasContext;if(o){var s=this._width,r=this._height;this._bgColor?(o.fillStyle=this._bgColor,o.fillRect(0,0,s,r)):o.clearRect(0,0,s,r);var h="function"==typeof this._updateHandler;for(h&&this._updateHandler(t,e),n=this._children[0];n;)h||n.update(t,e),n.draw(o,this._viewport),n=n.next}!this._disposed&&this._animate&&(this._renderPending=!0,this._renderId=window.requestAnimationFrame(this._renderHandler))},l.prototype.addListeners=function(){var t=this;this._eventHandler||(this._eventHandler=new n);var e=this._eventHandler,i=this.handleInteraction.bind(this),o=this._element;"ontouchstart"in window&&["start","move","end","cancel"].forEach((function(t){e.add(o,"touch".concat(t),i)})),["down","move"].forEach((function(t){e.add(o,"mouse".concat(t),i)})),e.add(window,"mouseup",i),this._viewport&&e.add(o,"wheel",i),this._stretchToFit&&e.add(window,"resize",(function(){t.stretchToFit(t._stretchToFit)}))},l.prototype.removeListeners=function(){this._eventHandler&&this._eventHandler.dispose(),this._eventHandler=null},l.prototype.getCoordinate=function(){return null===this._coords&&(this._coords=this._element.getBoundingClientRect()),this._coords};var c={loadImage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(i,o){var s=e||new window.Image,r=_(t),h=new n;r||(g(t,s),h.add(s,"load",(function(){h.dispose(),c.onReady(s).then((function(t){return i(v(s))})).catch(o)})),h.add(s,"error",(function(t){h.dispose(),o(t)}))),s.src=t,r&&c.onReady(s).then((function(t){return i(v(s))})).catch(o)}))},isReady:function(t){return!0===t.complete&&"number"==typeof t.naturalWidth&&t.naturalWidth>0},onReady:function(t){return new Promise((function(e,i){var n=0;!function o(){c.isReady(t)?e():60==++n?i(new Error("Image could not be resolved. This shouldn't occur.")):window.requestAnimationFrame(o)}()}))}};const f=c;function g(t,e){var i,n;i=t,n=window.location,i.startsWith("./")||i.startsWith("".concat(n.protocol,"//").concat(n.host))||!/^http[s]?:/.test(i)||(e.crossOrigin="Anonymous")}function _(t){var e=("string"==typeof t?t:t.src).substr(0,5);return"data:"===e||"blob:"===e}function v(t){var e={image:t,size:null};return t instanceof window.HTMLImageElement&&(e.size=function(t){return{width:t.width||t.naturalWidth,height:t.height||t.naturalHeight}}(t)),e}var m=function(t,e){var i=t.left,n=t.top;return i+t.width>=e.left&&i<=e.right&&n+t.height>=e.top&&n<=e.bottom},w=function(t,e){var i=t.left,n=t.top,o=t.width,s=t.height,r=e.left,h=e.top,a=e.width,d=e.height;return{src:{left:i>r?0:r-i,top:n>h?0:h-n,width:o=i>r?Math.min(o,a-(i-r)):Math.min(a,o-(r-i)),height:s=n>h?Math.min(s,d-(n-h)):Math.min(d,s-(h-n))},dest:{left:i>r?i-r:0,top:n>h?n-h:0,width:o,height:s}}},y=Math.min,b=Math.max,C=.5;function x(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,i=t.height,n=t.x,o=void 0===n?0:n,s=t.y,r=void 0===s?0:s,h=t.bitmap,a=void 0===h?null:h,d=t.collidable,l=void 0!==d&&d,p=t.interactive,u=void 0!==p&&p,c=t.mask,f=void 0!==c&&c,g=t.sheet,_=void 0===g?[]:g,v=t.sheetTileWidth,m=void 0===v?0:v,w=t.sheetTileHeight,y=void 0===w?0:w;if(e<=0||i<=0)throw new Error("cannot construct a zSprite without valid dimensions");if(this._children=[],this._disposed=!1,this.collidable=l,this.hover=!1,this._mask=f,this._bounds={left:0,top:0,width:e,height:i},this._parent=null,this.last=null,this.next=null,this.canvas=null,this._bitmap,this._bitmapReady=!1,this._draggable=!1,this._keepInBounds=!1,this.isDragging=!1,this.setX(o),this.setY(r),this.setInteractive(u),a&&this.setBitmap(a),Array.isArray(_)&&_.length>0){if(!a)throw new Error("cannot use a spritesheet without a valid Bitmap");this.setSheet(_,m,y)}}const I=x;x.extend=function(t){s.extend(t,x)},x.prototype.getDraggable=function(){return this._draggable},x.prototype.setDraggable=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._draggable=t,this._keepInBounds=!!this._constraint||e,t&&!this._interactive&&this.setInteractive(!0)},x.prototype.getX=function(){return this._bounds.left},x.prototype.setX=function(t){var e=t-this._bounds.left;this._bounds.left=this._constraint?t+this._constraint.left:t;for(var i=this._children[0];i;)i.isDragging||i.setX(i._bounds.left+e),i=i.next},x.prototype.getY=function(){return this._bounds.top},x.prototype.setY=function(t){var e=t-this._bounds.top;this._bounds.top=this._constraint?t+this._constraint.top:t;for(var i=this._children[0];i;)i.isDragging||i.setY(i._bounds.top+e),i=i.next},x.prototype.getWidth=function(){return this._bounds.width},x.prototype.setWidth=function(t){var e=this._bounds.width||0;this._bounds.width=t,0!==e&&(this._bounds.left-=t*C-e*C),this.invalidate()},x.prototype.getHeight=function(){return this._bounds.height},x.prototype.setHeight=function(t){var e=this._bounds.height||0;this._bounds.height=t,0!==e&&(this._bounds.top-=t*C-e*C),this.invalidate()},x.prototype.setBounds=function(t,e,i,n){if(this._constraint)t-=this._constraint.left,e-=this._constraint.top;else if(!this.canvas)throw new Error("cannot update position of a Sprite that has no constraint or is not added to a canvas");"number"==typeof i&&(this._bounds.width=i),"number"==typeof n&&(this._bounds.height=n);var o=this._bounds.width,s=this._bounds.height,r=this._constraint?this._constraint.width:this.canvas.width,h=this._constraint?this._constraint.height:this.canvas.height;if(this._keepInBounds){var a=y(0,-(o-r)),d=y(0,-(s-h)),l=h-s;t=y(r-o,b(t,a)),e=y(l,b(e,d))}else t>r&&(t+=o*C),e>h&&(e+=s*C);this.setX(t),this.setY(e)},x.prototype.getBounds=function(){return this._bounds},x.prototype.getInteractive=function(){return this._interactive},x.prototype.setInteractive=function(t){this._interactive=t},x.prototype.update=function(t,e){for(var i=this._children[0];i;)i.update(t),i=i.next;this._animation&&this.updateAnimation(e)},x.prototype.draw=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.canvas){var i=this._bounds,n=this._bitmapReady;if(n&&e&&(n=m(i,e)),t.save(),this._mask&&(t.globalCompositeOperation="destination-in"),n){var o=this._animation,s=i.left,r=i.top,h=i.width,a=i.height;if(o){var d=o.tileWidth?o.tileWidth:C+h<<0,l=o.tileHeight?o.tileHeight:C+a<<0;e&&(s-=e.left,r-=e.top),t.drawImage(this._bitmap,o.col*d,o.type.row*l,d,l,C+s<<0,C+r<<0,C+h<<0,C+a<<0)}else if(e){var p=w(i,e),u=p.src,c=p.dest;t.drawImage(this._bitmap,C+u.left<<0,C+u.top<<0,C+u.width<<0,C+u.height<<0,C+c.left<<0,C+c.top<<0,C+c.width<<0,C+c.height<<0)}else t.drawImage(this._bitmap,C+s<<0,C+r<<0,C+h<<0,C+a<<0)}for(var f=this._children[0];f;)f.draw(t,e),f=f.next;this._mask&&(t.globalCompositeOperation="source-over"),t.restore(),this.canvas.DEBUG&&this.drawOutline(t)}},x.prototype.insideBounds=function(t,e){var i=this._bounds,n=i.left,o=i.top,s=i.width,r=i.height;return t>=n&&t<=n+s&&e>=o&&e<=o+r},x.prototype.collidesWith=function(t){if(t===this)return!1;var e=this._bounds,i=t.getBounds();return!(e.top+e.height<i.top||e.top>i.top+i.height||e.left+e.width<i.left||e.left>i.left+i.width)},x.prototype.getIntersection=function(t){if(this.collidesWith(t)){var e=this._bounds,i=t.getBounds(),n=b(e.left,i.left),o=b(e.top,i.top);return{left:n,top:o,width:y(e.left+e.width,i.width+i.height)-n,height:y(e.top+e.height,i.top+i.height)-o}}return null},x.prototype.collidesWithEdge=function(t,e){if(t===this)return!1;if(isNaN(e)||e<0||e>3)throw new Error("invalid argument for edge");switch(e){case 0:return this.getX()<=t.getX()+t.getWidth();case 1:return this.getY()<=t.getY()+t.getHeight();case 2:return this.getX()+this.getWidth()<=t.getX();case 3:return this.getY()+this.getHeight()>=t.getY()}return!1},x.prototype.getBitmap=function(){return this._bitmap},x.prototype.setBitmap=function(t,e,i){var n=this,o=t instanceof window.HTMLCanvasElement,s=t instanceof window.HTMLImageElement;if(t&&!o&&!s&&"string"!=typeof t)throw new Error('expected HTMLImageElement, HTMLCanvasElement or String for Image source, got "'.concat(t,'" instead'));return new Promise((function(r,h){if(n._bitmap!==t&&(n._bitmapReady=!1),t){var a="number"==typeof e,d="number"==typeof i;if(a&&n.setWidth(e),d&&n.setHeight(i),n._keepInBounds&&n.canvas&&(a||d)){var l=-(n._bounds.width-n.canvas.getWidth()),p=-(n._bounds.height-n.canvas.getHeight());n._bounds.left>0?n._bounds.left=0:n._bounds.left<l&&(n._bounds.left=l),n._bounds.top>0?n._bounds.top=0:n._bounds.top<p&&(n._bounds.top=p)}if(o)return n._bitmap=t,n._bitmapReady=!0,r();f.loadImage(s?t.src:t,s?t:null).then((function(t){var e=t.size,i=t.image;n._bitmap=i,n._bitmapReady=!0,n._bitmapWidth=e.width,n._bitmapHeight=e.height,n.invalidate(),r()})).catch((function(t){h(new Error('zSprite.setBitmap() "'.concat(null==t?void 0:t.message,'" occurred.')))}))}else n._bitmap=null}))},x.prototype.setSheet=function(t,e,i){this._sheet=t,t?(this._animation={type:null,col:0,maxCol:0,fpt:0,counter:0},"number"==typeof e&&(this._animation.tileWidth=e),"number"==typeof i&&(this._animation.tileHeight=i),this.switchAnimation(0)):this._animation=null},x.prototype.switchAnimation=function(t){var e=this._animation,i=this._sheet[t];e.type=i,e.fpt=i.fpt,e.maxCol=i.col+(i.amount-1),e.col=i.col,e.counter=0,e.onComplete=i.onComplete},x.prototype.setParent=function(t){this._parent=t},x.prototype.getParent=function(){return this._parent},x.prototype.setCanvas=function(t){this.canvas=t,this._children.forEach((function(e){e.setCanvas(t)}))},x.prototype.setConstraint=function(t,e,i,n){return this._constraint={left:t,top:e,width:i,height:n},this._bounds.left=b(t,this._bounds.left),this._bounds.top=b(e,this._bounds.top),this._keepInBounds=!0,this.getConstraint()},x.prototype.getConstraint=function(){return this._constraint},x.prototype.addChild=function(t){if(this.contains(t))return this;var e=this._children.length;return e>0&&(t.last=this._children[e-1],t.last.next=t,t.next=null),t.setCanvas(this.canvas),t.setParent(this),this._children.push(t),this.invalidate(),this},x.prototype.removeChild=function(t){t.setParent(null),t.setCanvas(null);var e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1);var i=t.last,n=t.next;return i&&(i.next=n),n&&(n.last=i),t.last=t.next=null,this.invalidate(),t},x.prototype.getChildAt=function(t){return this._children[t]},x.prototype.removeChildAt=function(t){return this.removeChild(this.getChildAt(t))},x.prototype.numChildren=function(){return this._children.length},x.prototype.getChildren=function(){return this._children},x.prototype.contains=function(t){return t._parent===this},x.prototype.dispose=function(){if(!this._disposed){this._disposed=!0,this._parent&&this._parent.removeChild(this);for(var t=this._children.length;t--;){var e=this._children[t];e.dispose(),e.next=null,e.last=null}this._children=[]}},x.prototype.handlePress=function(t,e,i){},x.prototype.handleRelease=function(t,e,i){},x.prototype.handleClick=function(){},x.prototype.handleMove=function(t,e,i){var n=this._dragStartOffset.x+(t-this._dragStartEventCoordinates.x),o=this._dragStartOffset.y+(e-this._dragStartEventCoordinates.y);this.setBounds(n,o,this._bounds.width,this._bounds.height)},x.prototype.handleInteraction=function(t,e,i){var n,o=this._children.length;if(o>0)for(n=this._children[o-1];n;){if(n.handleInteraction(t,e,i))return!0;n=n.last}if(!this._interactive)return!1;var s=i.type;if(this._pressed&&("touchend"===s||"mouseup"===s))return this._pressed=!1,this.isDragging&&(this.isDragging=!1),Date.now()-this._pressTime<250&&this.handleClick(),this.handleRelease(t,e,i),!0;if(this.insideBounds(t,e)){if(this.hover=!0,"touchstart"===s||"mousedown"===s)return this._pressTime=Date.now(),this._pressed=!0,this._draggable&&(this.isDragging=!0,this._dragStartOffset={x:this._bounds.left,y:this._bounds.top},this._dragStartEventCoordinates={x:t,y:e}),this.handlePress(t,e,i),"touchstart"===s&&(i.stopPropagation(),i.preventDefault()),!0}else this.hover=!1;return!!this.isDragging&&(this.handleMove(t,e,i),!0)},x.prototype.updateAnimation=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this._animation;e.counter+=t,e.counter>=e.fpt&&(++e.col,e.counter=e.counter%e.fpt),e.col>e.maxCol&&(e.col=e.type.col,"function"==typeof e.onComplete&&e.onComplete(this))},x.prototype.invalidate=function(){this.canvas&&this.canvas.invalidate()},x.prototype.drawOutline=function(t){t.lineWidth=1,t.strokeStyle="#FF0000",t.strokeRect(this.getX(),this.getY(),this.getWidth(),this.getHeight())};var E=document.createElement("canvas"),H=E.getContext("2d"),S=new Map,R=[],P=[],M=function(t,e,i){var n,o,s,r,h=t.getBitmap(),a=t.getBounds(),d=parseInt(e.left-a.left),l=parseInt(e.top-a.top),p=parseInt(e.width),u=parseInt(e.height);if(0===p||0===u)return i.length=0;i.length=parseInt(p*u);var c=S.get(h);if(c&&d+p<h.width)n=c,o=h.width,r=l,s=d;else{var f=!(h instanceof window.HTMLCanvasElement),g=f?H:h.getContext("2d");f&&k(E,h,a.width,a.height),n=g.getImageData(d,l,p,u).data,o=p,r=0,s=0}for(var _=r+u,v=s+p,m=-1,w=r;w<_;++w)for(var y=s;y<v;++y){var b=4*(w*o+y);i[++m]=n[b+3]<<24|n[b]<<16|n[b+1]<<8|n[b+2]}},B=function(t){return S.has(t)};function k(t,e,i,n){var o=t.getContext("2d");return t.width=i,t.height=n,o.clearRect(0,0,i,n),o.drawImage(e,0,0,i,n),o}var D={pixelCollision:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.getIntersection(e);if(null===n)return!1;M(t,n,R),M(e,n,P);var o=0;if(!0===i)for(var s=n.width,r=n.height,h=0;h<r;++h)for(var a=0;a<s;++a){if(0!==R[o]&&0!==P[o])return{x:a,y:h};++o}else for(var d=R.length;o<d;++o)if(0!==R[o]&&0!==P[o])return!0;return!1},getChildrenUnderPoint:function(t,e,i,n,o){for(var s,r,h,a,d,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=[],u=t.length;u--;)r=(s=t[u]).getX(),h=s.getY(),a=s.getWidth(),d=s.getHeight(),r<e+n&&r+a>e&&h<i+o&&h+d>i&&(!l||l&&s.collidable)&&p.push(s);return p},cache:function(t){return new Promise((function(e,i){t instanceof window.HTMLCanvasElement?(S.set(t,t.getContext("2d").getImageData(0,0,t.width,t.height).data),e(!0)):f.onReady(t).then((function(){var i=t.width,n=t.height;S.set(t,k(E,t,i,n).getImageData(0,0,i,n).data),E.width=E.height=1,e(!0)})).catch(i)}))},hasCache:B,clearCache:function(t){return!!B(t)&&(S.delete(t),!0)}};return e})()));