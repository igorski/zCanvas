var zcanvas=function(t){"use strict";class e{constructor(){this._eventMap=[],this._disposed=!1}add(t,e,s){return!this.has(t,e)&&(t.addEventListener(e,s,!1),this._eventMap.push({target:t,type:e,listener:s}),!0)}has(t,e){let s=this._eventMap.length;for(;s--;){const i=this._eventMap[s];if(i.target===t&&i.type==e)return!0}return!1}remove(t,e){let s=this._eventMap.length;for(;s--;){const i=this._eventMap[s];if(i.target===t&&i.type===e)return t.removeEventListener(e,i.listener,!1),this._eventMap.splice(s,1),!0}return!1}dispose(){if(this._disposed)return;let t=this._eventMap.length;for(;t--;){const e=this._eventMap[t];this.remove(e.target,e.type)}this._eventMap=null,this._disposed=!0}}let s;function i(t=0,e=0,s=!1){const i=document.createElement("canvas"),h=i.getContext("2d",s?{willReadFrequently:!0}:void 0);return 0!==t&&0!==e&&(i.width=t,i.height=e),{cvs:i,ctx:h}}function h(){return s||(s=i().cvs),s}async function n(t){t instanceof Blob&&(t=await async function(t){const e=await a(t),{cvs:s,ctx:h}=i(e.width,e.height);return h.drawImage(e,0,0),s}(t)),o(h(),t);const e=await createImageBitmap(h());return s.width=1,s.height=1,e}function a(t){const e=URL.createObjectURL(t),s=()=>{URL.revokeObjectURL(e)};return new Promise(((t,i)=>{const h=new Image;h.onload=()=>{s(),t(h)},h.onerror=t=>{s(),i(t)},h.src=e}))}function o(t,e,s,i){const h=t.getContext("2d");s=s??e.width,i=i??e.height,t.width=s,t.height=i,h.clearRect(0,0,s,i),h.drawImage(e,0,0,s,i)}async function r(t){const e=new FileReader;return new Promise(((s,i)=>{e.onload=e=>{var h;if(!(null==(h=null==e?void 0:e.target)?void 0:h.result))return i();s(new Blob([e.target.result],{type:t.type}))},e.onerror=t=>i(t),e.readAsArrayBuffer(t)}))}const l={loadImage:t=>new Promise((async(s,i)=>{let h;if(t instanceof File?h=await r(t):t instanceof Blob&&(h=t),void 0!==h){try{const t=await a(h);l.onReady(t).then((()=>s(d(t))))}catch(g){i(g)}return}const n=function(t){const e=t.substring(0,5);return"data:"===e||"blob:"===e}(t),o=new window.Image,c=new e,p=()=>{c.dispose(),l.onReady(o).then((()=>s(d(o)))).catch(i)};var u;n||(u=o,function(t){const{location:e}=window;return!(!t.startsWith("./")&&!t.startsWith(`${e.protocol}//${e.host}`)&&/^http[s]?:/.test(t))}(t)||(u.crossOrigin="Anonymous"),c.add(o,"load",p),c.add(o,"error",(()=>{c.dispose(),i()}))),o.src=t,n&&p()})),async loadBitmap(t){const{image:e}=await l.loadImage(t);return n(e)},isReady:t=>!0===t.complete&&"number"==typeof t.naturalWidth&&t.naturalWidth>0,onReady:t=>new Promise(((e,s)=>{let i=0;!function h(){l.isReady(t)?e():60==++i?s(new Error("Image could not be resolved.")):requestAnimationFrame(h)}()}))};function d(t){const e={image:t,size:{width:0,height:0}};return t instanceof window.HTMLImageElement&&(e.size={width:(s=t).width||s.naturalWidth,height:s.height||s.naturalHeight}),e;var s}function c(t,e){e.font=`${t.size}${t.unit} "${t.font}"`,e.fillStyle=t.color}class p{constructor(t,e){this._index=0,this._map=new Map,this._createFn=t,this._destroyFn=e}dispose(){const t=[...this._map].map((([t])=>t));for(;t.length>0;)this.remove(t.shift());this._map=void 0}get(t){return this._map.get(t)}set(t,e){if(this.has(t)){if(this.get(t)===e)return;this.remove(t)}this._map.set(t,e)}has(t){return this._map.has(t)}remove(t){var e;if(!this.has(t))return!1;const s=this.get(t);return null==(e=this._destroyFn)||e.call(this,s),this._map.delete(t)}next(){let t;const e=this._index.toString();return this.has(e)?t=this.get(e):this._createFn&&(t=this._createFn(),this.set(e,t)),++this._index,t}fill(t){const e=this._index;for(let s=0;s<t;++s)this.next();this._index=e}reset(){this._index=0}}const{min:u,max:g}=Math,m=.5;let _,b,w,f;const Z=Math.PI/180;function v(t){return t>0?t+.5<<0:0|t}function G(t,e,s){const{left:i,top:h,width:n,height:a}=t;return s.width=n*e,s.height=a*e,s.left=i-(s.width-n)*m,s.top=h-(s.height-a)*m,s}const y="transparent",x=.5;let R,X=1,W="setTransform";class C{constructor(t,e=!1){this._debug=e,this._cvs=t,this._ctx=t.getContext("2d"),this._bmp=new p(void 0,(t=>{t.close()})),this._ptn=new p}dispose(){this._bmp.dispose(),this._ptn.dispose(),this._cvs=void 0}cacheResource(t,e){this._bmp.set(t,e)}getResource(t){return this._bmp.get(t)}disposeResource(t){this._bmp.remove(t)}setDimensions(t,e){this._cvs.width=t,this._cvs.height=e}setSmoothing(t){const e=this._ctx;["imageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","webkitImageSmoothingEnabled"].forEach((s=>{void 0!==e[s]&&(e[s]=t)}))}setPixelRatio(t){X=t,W=1===X?"setTransform":"transform"}save(){this._ctx.save()}restore(){this._ctx.restore()}translate(t,e){this._ctx.translate(t,e)}rotate(t){this._ctx.rotate(t)}transform(t,e,s,i,h,n){this._ctx.transform(t,e,s,i,h,n)}scale(t,e=t){this._ctx.scale(t,e)}setBlendMode(t){this._ctx.globalCompositeOperation=t}setAlpha(t){this._ctx.globalAlpha=t}drawPath(t,e=y,s){R.beginPath(),R.moveTo(t[0].x,t[0].y);for(const i of t)R.lineTo(i.x,i.y);e!==y&&R.fill(),s&&(R.lineWidth=s.size,R.strokeStyle=s.color,R.stroke()),R.closePath()}clearRect(t,e,s,i,h){const n=h?this.prepare(h,t,e,s,i):0;this._ctx.clearRect(t,e,s,i),this.applyReset(n)}drawRect(t,e,s,i,h=y,n,a){const o=a?this.prepare(a,t,e,s,i):0;R=this._ctx,h!==y&&(R.fillStyle=h,R.fillRect(t,e,s,i)),n&&(R.lineWidth=n.size,R.strokeStyle=n.color,R.strokeRect(x+t,x+e,s,i)),this.applyReset(o)}drawRoundRect(t,e,s,i,h,n=y,a,o){const r=o?this.prepare(o,t,e,s,i):0;R=this._ctx,n!==y&&(R.fillStyle=n,R.fillRect(t,e,s,i)),a&&(R.lineWidth=a.size,R.strokeStyle=a.color,R.beginPath(),R.roundRect(x+t,x+e,s,i,h),R.stroke()),this.applyReset(r)}drawCircle(t,e,s,i=y,h,n){const a=n?this.prepare(n,t,e,2*s,2*s):0;R=this._ctx,R.beginPath(),R.arc(t+s,e+s,s,0,2*Math.PI,!1),i!==y&&(R.fillStyle=i,R.fill()),h&&(R.lineWidth=h.size,R.strokeStyle=h.color,R.closePath(),R.stroke()),this.applyReset(a)}drawImage(t,e,s,i,h,n){if(!this._bmp.has(t))return;const a=n?this.prepare(n,e,s,i,h):0;void 0===i?this._ctx.drawImage(this._bmp.get(t),e,s):this._ctx.drawImage(this._bmp.get(t),e,s,i,h),this._debug&&this.drawRect(e,s,i,h,y,{size:1,color:"red"}),this.applyReset(a)}drawImageCropped(t,e,s,i,h,n,a,o,r,l){if(!this._bmp.has(t))return;if(null==l?void 0:l.safeMode){if(o<=0||r<=0)return;const n=this._bmp.get(t),a=(o=Math.min(this._ctx.canvas.width,o))/i,l=(r=Math.min(this._ctx.canvas.height,r))/h;e+i>n.width&&(o-=a*(e+i-n.width),i-=e+i-n.width),s+h>n.height&&(r-=l*(s+h-n.height),h-=s+h-n.height)}const d=l?this.prepare(l,n,a,o,r):0;this._ctx.drawImage(this._bmp.get(t),x+e<<0,x+s<<0,x+i<<0,x+h<<0,x+n<<0,x+a<<0,x+o<<0,x+r<<0),this._debug&&this.drawRect(n,a,o,r,y,{size:1,color:"red"}),this.applyReset(d)}drawText(t,e,s,i){const{lines:h,width:n,height:a}=function(t,e){c(t,e);const s=t.text.split("\n"),i=[];let h,n=0,a=0,o=e.measureText("Wq");h=t.lineHeight?t.lineHeight:o.actualBoundingBoxAscent+o.actualBoundingBoxDescent;const r=o.actualBoundingBoxAscent;let l=0;return s.forEach(((s,d)=>{if(l=Math.round(r+d*h),t.spacing){const e=s.split("");n=Math.max(n,e.length*t.spacing)}else o=e.measureText(s),n=Math.max(n,o.actualBoundingBoxRight);i.push({line:s,top:l}),a+=h})),{lines:i,width:Math.ceil(n),height:Math.ceil(a)}}(t,this._ctx);t.center&&(e-=n*x,s-=a*x);const o=i?this.prepare(i,e,s,n,a):0;!function(t,e,s,i,h){c(s,t);const n=s.spacing??1;e.forEach((({line:e,top:a})=>{s.spacing?e.split("").forEach(((e,s)=>{t.fillText(e,i+Math.round(s*n),h+a)})):t.fillText(e,i,h+a)}))}(this._ctx,h,t,e,s),this.applyReset(o)}createPattern(t,e){this._bmp.has(t)&&this._ptn.set(t,this._ctx.createPattern(this._bmp.get(t),e))}drawPattern(t,e,s,i,h){if(!this._ptn.has(t))return;const n=this._ptn.get(t);this._ctx.fillStyle=n,this._ctx.fillRect(e,s,i,h)}prepare(t,e,s,i,h){var n,a;const o=1!==t.scale,r=0!==t.rotation,l=1!==t.alpha,d=void 0!==t.blendMode,c=l||d,p=o||r;if(c)this.save();else if(!p)return 0;if(p){const o=t.scale??1,r=(null==(n=t.pivot)?void 0:n.x)??e+i*x,l=(null==(a=t.pivot)?void 0:a.y)??s+h*x,d=t.rotation*Z,c=Math.cos(d)*o,p=Math.sin(d)*o;this._ctx[W](c,p,-p,c,r-r*c+l*p,l-r*p-l*c)}return d&&this.setBlendMode(t.blendMode),l&&this.setAlpha(t.alpha),c?1:2}applyReset(t){2===t?this._ctx.setTransform(X,0,0,X,0,0):1===t&&this.restore()}}const L="IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHQodCxlKXtlLmZvbnQ9YCR7dC5zaXplfSR7dC51bml0fSAiJHt0LmZvbnR9ImAsZS5maWxsU3R5bGU9dC5jb2xvcn1jbGFzcyBle2NvbnN0cnVjdG9yKHQsZSl7dGhpcy5faW5kZXg9MCx0aGlzLl9tYXA9bmV3IE1hcCx0aGlzLl9jcmVhdGVGbj10LHRoaXMuX2Rlc3Ryb3lGbj1lfWRpc3Bvc2UoKXtjb25zdCB0PVsuLi50aGlzLl9tYXBdLm1hcCgoKFt0XSk9PnQpKTtmb3IoO3QubGVuZ3RoPjA7KXRoaXMucmVtb3ZlKHQuc2hpZnQoKSk7dGhpcy5fbWFwPXZvaWQgMH1nZXQodCl7cmV0dXJuIHRoaXMuX21hcC5nZXQodCl9c2V0KHQsZSl7aWYodGhpcy5oYXModCkpe2lmKHRoaXMuZ2V0KHQpPT09ZSlyZXR1cm47dGhpcy5yZW1vdmUodCl9dGhpcy5fbWFwLnNldCh0LGUpfWhhcyh0KXtyZXR1cm4gdGhpcy5fbWFwLmhhcyh0KX1yZW1vdmUodCl7dmFyIGU7aWYoIXRoaXMuaGFzKHQpKXJldHVybiExO2NvbnN0IHM9dGhpcy5nZXQodCk7cmV0dXJuIG51bGw9PShlPXRoaXMuX2Rlc3Ryb3lGbil8fGUuY2FsbCh0aGlzLHMpLHRoaXMuX21hcC5kZWxldGUodCl9bmV4dCgpe2xldCB0O2NvbnN0IGU9dGhpcy5faW5kZXgudG9TdHJpbmcoKTtyZXR1cm4gdGhpcy5oYXMoZSk/dD10aGlzLmdldChlKTp0aGlzLl9jcmVhdGVGbiYmKHQ9dGhpcy5fY3JlYXRlRm4oKSx0aGlzLnNldChlLHQpKSwrK3RoaXMuX2luZGV4LHR9ZmlsbCh0KXtjb25zdCBlPXRoaXMuX2luZGV4O2ZvcihsZXQgcz0wO3M8dDsrK3MpdGhpcy5uZXh0KCk7dGhpcy5faW5kZXg9ZX1yZXNldCgpe3RoaXMuX2luZGV4PTB9fWNvbnN0IHM9TWF0aC5QSS8xODAsaT0idHJhbnNwYXJlbnQiLGE9LjU7bGV0IG8scixuLGg9MSxjPSJzZXRUcmFuc2Zvcm0iO2NsYXNzIGx7Y29uc3RydWN0b3IodCxzPSExKXt0aGlzLl9kZWJ1Zz1zLHRoaXMuX2N2cz10LHRoaXMuX2N0eD10LmdldENvbnRleHQoIjJkIiksdGhpcy5fYm1wPW5ldyBlKHZvaWQgMCwodD0+e3QuY2xvc2UoKX0pKSx0aGlzLl9wdG49bmV3IGV9ZGlzcG9zZSgpe3RoaXMuX2JtcC5kaXNwb3NlKCksdGhpcy5fcHRuLmRpc3Bvc2UoKSx0aGlzLl9jdnM9dm9pZCAwfWNhY2hlUmVzb3VyY2UodCxlKXt0aGlzLl9ibXAuc2V0KHQsZSl9Z2V0UmVzb3VyY2UodCl7cmV0dXJuIHRoaXMuX2JtcC5nZXQodCl9ZGlzcG9zZVJlc291cmNlKHQpe3RoaXMuX2JtcC5yZW1vdmUodCl9c2V0RGltZW5zaW9ucyh0LGUpe3RoaXMuX2N2cy53aWR0aD10LHRoaXMuX2N2cy5oZWlnaHQ9ZX1zZXRTbW9vdGhpbmcodCl7Y29uc3QgZT10aGlzLl9jdHg7WyJpbWFnZVNtb290aGluZ0VuYWJsZWQiLCJtb3pJbWFnZVNtb290aGluZ0VuYWJsZWQiLCJvSW1hZ2VTbW9vdGhpbmdFbmFibGVkIiwid2Via2l0SW1hZ2VTbW9vdGhpbmdFbmFibGVkIl0uZm9yRWFjaCgocz0+e3ZvaWQgMCE9PWVbc10mJihlW3NdPXQpfSkpfXNldFBpeGVsUmF0aW8odCl7aD10LGM9MT09PWg/InNldFRyYW5zZm9ybSI6InRyYW5zZm9ybSJ9c2F2ZSgpe3RoaXMuX2N0eC5zYXZlKCl9cmVzdG9yZSgpe3RoaXMuX2N0eC5yZXN0b3JlKCl9dHJhbnNsYXRlKHQsZSl7dGhpcy5fY3R4LnRyYW5zbGF0ZSh0LGUpfXJvdGF0ZSh0KXt0aGlzLl9jdHgucm90YXRlKHQpfXRyYW5zZm9ybSh0LGUscyxpLGEsbyl7dGhpcy5fY3R4LnRyYW5zZm9ybSh0LGUscyxpLGEsbyl9c2NhbGUodCxlPXQpe3RoaXMuX2N0eC5zY2FsZSh0LGUpfXNldEJsZW5kTW9kZSh0KXt0aGlzLl9jdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uPXR9c2V0QWxwaGEodCl7dGhpcy5fY3R4Lmdsb2JhbEFscGhhPXR9ZHJhd1BhdGgodCxlPWkscyl7by5iZWdpblBhdGgoKSxvLm1vdmVUbyh0WzBdLngsdFswXS55KTtmb3IoY29uc3QgaSBvZiB0KW8ubGluZVRvKGkueCxpLnkpO2UhPT1pJiZvLmZpbGwoKSxzJiYoby5saW5lV2lkdGg9cy5zaXplLG8uc3Ryb2tlU3R5bGU9cy5jb2xvcixvLnN0cm9rZSgpKSxvLmNsb3NlUGF0aCgpfWNsZWFyUmVjdCh0LGUscyxpLGEpe2NvbnN0IG89YT90aGlzLnByZXBhcmUoYSx0LGUscyxpKTowO3RoaXMuX2N0eC5jbGVhclJlY3QodCxlLHMsaSksdGhpcy5hcHBseVJlc2V0KG8pfWRyYXdSZWN0KHQsZSxzLHIsbj1pLGgsYyl7Y29uc3QgbD1jP3RoaXMucHJlcGFyZShjLHQsZSxzLHIpOjA7bz10aGlzLl9jdHgsbiE9PWkmJihvLmZpbGxTdHlsZT1uLG8uZmlsbFJlY3QodCxlLHMscikpLGgmJihvLmxpbmVXaWR0aD1oLnNpemUsby5zdHJva2VTdHlsZT1oLmNvbG9yLG8uc3Ryb2tlUmVjdChhK3QsYStlLHMscikpLHRoaXMuYXBwbHlSZXNldChsKX1kcmF3Um91bmRSZWN0KHQsZSxzLHIsbixoPWksYyxsKXtjb25zdCBkPWw/dGhpcy5wcmVwYXJlKGwsdCxlLHMscik6MDtvPXRoaXMuX2N0eCxoIT09aSYmKG8uZmlsbFN0eWxlPWgsby5maWxsUmVjdCh0LGUscyxyKSksYyYmKG8ubGluZVdpZHRoPWMuc2l6ZSxvLnN0cm9rZVN0eWxlPWMuY29sb3Isby5iZWdpblBhdGgoKSxvLnJvdW5kUmVjdChhK3QsYStlLHMscixuKSxvLnN0cm9rZSgpKSx0aGlzLmFwcGx5UmVzZXQoZCl9ZHJhd0NpcmNsZSh0LGUscyxhPWkscixuKXtjb25zdCBoPW4/dGhpcy5wcmVwYXJlKG4sdCxlLDIqcywyKnMpOjA7bz10aGlzLl9jdHgsby5iZWdpblBhdGgoKSxvLmFyYyh0K3MsZStzLHMsMCwyKk1hdGguUEksITEpLGEhPT1pJiYoby5maWxsU3R5bGU9YSxvLmZpbGwoKSksciYmKG8ubGluZVdpZHRoPXIuc2l6ZSxvLnN0cm9rZVN0eWxlPXIuY29sb3Isby5jbG9zZVBhdGgoKSxvLnN0cm9rZSgpKSx0aGlzLmFwcGx5UmVzZXQoaCl9ZHJhd0ltYWdlKHQsZSxzLGEsbyxyKXtpZighdGhpcy5fYm1wLmhhcyh0KSlyZXR1cm47Y29uc3Qgbj1yP3RoaXMucHJlcGFyZShyLGUscyxhLG8pOjA7dm9pZCAwPT09YT90aGlzLl9jdHguZHJhd0ltYWdlKHRoaXMuX2JtcC5nZXQodCksZSxzKTp0aGlzLl9jdHguZHJhd0ltYWdlKHRoaXMuX2JtcC5nZXQodCksZSxzLGEsbyksdGhpcy5fZGVidWcmJnRoaXMuZHJhd1JlY3QoZSxzLGEsbyxpLHtzaXplOjEsY29sb3I6InJlZCJ9KSx0aGlzLmFwcGx5UmVzZXQobil9ZHJhd0ltYWdlQ3JvcHBlZCh0LGUscyxvLHIsbixoLGMsbCxkKXtpZighdGhpcy5fYm1wLmhhcyh0KSlyZXR1cm47aWYobnVsbD09ZD92b2lkIDA6ZC5zYWZlTW9kZSl7aWYoYzw9MHx8bDw9MClyZXR1cm47Y29uc3QgaT10aGlzLl9ibXAuZ2V0KHQpLGE9KGM9TWF0aC5taW4odGhpcy5fY3R4LmNhbnZhcy53aWR0aCxjKSkvbyxuPShsPU1hdGgubWluKHRoaXMuX2N0eC5jYW52YXMuaGVpZ2h0LGwpKS9yO2Urbz5pLndpZHRoJiYoYy09YSooZStvLWkud2lkdGgpLG8tPWUrby1pLndpZHRoKSxzK3I+aS5oZWlnaHQmJihsLT1uKihzK3ItaS5oZWlnaHQpLHItPXMrci1pLmhlaWdodCl9Y29uc3QgcD1kP3RoaXMucHJlcGFyZShkLG4saCxjLGwpOjA7dGhpcy5fY3R4LmRyYXdJbWFnZSh0aGlzLl9ibXAuZ2V0KHQpLGErZTw8MCxhK3M8PDAsYStvPDwwLGErcjw8MCxhK248PDAsYStoPDwwLGErYzw8MCxhK2w8PDApLHRoaXMuX2RlYnVnJiZ0aGlzLmRyYXdSZWN0KG4saCxjLGwsaSx7c2l6ZToxLGNvbG9yOiJyZWQifSksdGhpcy5hcHBseVJlc2V0KHApfWRyYXdUZXh0KGUscyxpLG8pe2NvbnN0e2xpbmVzOnIsd2lkdGg6bixoZWlnaHQ6aH09ZnVuY3Rpb24oZSxzKXt0KGUscyk7Y29uc3QgaT1lLnRleHQuc3BsaXQoIlxuIiksYT1bXTtsZXQgbyxyPTAsbj0wLGg9cy5tZWFzdXJlVGV4dCgiV3EiKTtvPWUubGluZUhlaWdodD9lLmxpbmVIZWlnaHQ6aC5hY3R1YWxCb3VuZGluZ0JveEFzY2VudCtoLmFjdHVhbEJvdW5kaW5nQm94RGVzY2VudDtjb25zdCBjPWguYWN0dWFsQm91bmRpbmdCb3hBc2NlbnQ7bGV0IGw9MDtyZXR1cm4gaS5mb3JFYWNoKCgodCxpKT0+e2lmKGw9TWF0aC5yb3VuZChjK2kqbyksZS5zcGFjaW5nKXtjb25zdCBzPXQuc3BsaXQoIiIpO3I9TWF0aC5tYXgocixzLmxlbmd0aCplLnNwYWNpbmcpfWVsc2UgaD1zLm1lYXN1cmVUZXh0KHQpLHI9TWF0aC5tYXgocixoLmFjdHVhbEJvdW5kaW5nQm94UmlnaHQpO2EucHVzaCh7bGluZTp0LHRvcDpsfSksbis9b30pKSx7bGluZXM6YSx3aWR0aDpNYXRoLmNlaWwociksaGVpZ2h0Ok1hdGguY2VpbChuKX19KGUsdGhpcy5fY3R4KTtlLmNlbnRlciYmKHMtPW4qYSxpLT1oKmEpO2NvbnN0IGM9bz90aGlzLnByZXBhcmUobyxzLGksbixoKTowOyFmdW5jdGlvbihlLHMsaSxhLG8pe3QoaSxlKTtjb25zdCByPWkuc3BhY2luZz8/MTtzLmZvckVhY2goKCh7bGluZTp0LHRvcDpzfSk9PntpLnNwYWNpbmc/dC5zcGxpdCgiIikuZm9yRWFjaCgoKHQsaSk9PntlLmZpbGxUZXh0KHQsYStNYXRoLnJvdW5kKGkqciksbytzKX0pKTplLmZpbGxUZXh0KHQsYSxvK3MpfSkpfSh0aGlzLl9jdHgscixlLHMsaSksdGhpcy5hcHBseVJlc2V0KGMpfWNyZWF0ZVBhdHRlcm4odCxlKXt0aGlzLl9ibXAuaGFzKHQpJiZ0aGlzLl9wdG4uc2V0KHQsdGhpcy5fY3R4LmNyZWF0ZVBhdHRlcm4odGhpcy5fYm1wLmdldCh0KSxlKSl9ZHJhd1BhdHRlcm4odCxlLHMsaSxhKXtpZighdGhpcy5fcHRuLmhhcyh0KSlyZXR1cm47Y29uc3Qgbz10aGlzLl9wdG4uZ2V0KHQpO3RoaXMuX2N0eC5maWxsU3R5bGU9byx0aGlzLl9jdHguZmlsbFJlY3QoZSxzLGksYSl9cHJlcGFyZSh0LGUsaSxvLHIpe3ZhciBuLGg7Y29uc3QgbD0xIT09dC5zY2FsZSxkPTAhPT10LnJvdGF0aW9uLHA9MSE9PXQuYWxwaGEsbT12b2lkIDAhPT10LmJsZW5kTW9kZSxnPXB8fG0sdT1sfHxkO2lmKGcpdGhpcy5zYXZlKCk7ZWxzZSBpZighdSlyZXR1cm4gMDtpZih1KXtjb25zdCBsPXQuc2NhbGU/PzEsZD0obnVsbD09KG49dC5waXZvdCk/dm9pZCAwOm4ueCk/P2UrbyphLHA9KG51bGw9PShoPXQucGl2b3QpP3ZvaWQgMDpoLnkpPz9pK3IqYSxtPXQucm90YXRpb24qcyxnPU1hdGguY29zKG0pKmwsdT1NYXRoLnNpbihtKSpsO3RoaXMuX2N0eFtjXShnLHUsLXUsZyxkLWQqZytwKnUscC1kKnUtcCpnKX1yZXR1cm4gbSYmdGhpcy5zZXRCbGVuZE1vZGUodC5ibGVuZE1vZGUpLHAmJnRoaXMuc2V0QWxwaGEodC5hbHBoYSksZz8xOjJ9YXBwbHlSZXNldCh0KXsyPT09dD90aGlzLl9jdHguc2V0VHJhbnNmb3JtKGgsMCwwLGgsMCwwKToxPT09dCYmdGhpcy5yZXN0b3JlKCl9fW9ubWVzc2FnZT10PT57c3dpdGNoKHQuZGF0YS5jbWQpe2RlZmF1bHQ6YnJlYWs7Y2FzZSJpbml0IjpuPXQuZGF0YS5jYW52YXMscj1uZXcgbChuLHQuZGF0YS5kZWJ1Zyk7YnJlYWs7Y2FzZSJsb2FkUmVzb3VyY2UiOiFhc3luYyBmdW5jdGlvbih0LGUpe3RyeXtsZXQgcztpZihlIGluc3RhbmNlb2YgRmlsZSl7Y29uc3QgdD1hd2FpdCBhc3luYyBmdW5jdGlvbih0KXtjb25zdCBlPW5ldyBGaWxlUmVhZGVyO3JldHVybiBuZXcgUHJvbWlzZSgoKHMsaSk9PntlLm9ubG9hZD1lPT57dmFyIGE7aWYoIShudWxsPT0oYT1udWxsPT1lP3ZvaWQgMDplLnRhcmdldCk/dm9pZCAwOmEucmVzdWx0KSlyZXR1cm4gaSgpO3MobmV3IEJsb2IoW2UudGFyZ2V0LnJlc3VsdF0se3R5cGU6dC50eXBlfSkpfSxlLm9uZXJyb3I9dD0+aSh0KSxlLnJlYWRBc0FycmF5QnVmZmVyKHQpfSkpfShlKTtzPWF3YWl0IGNyZWF0ZUltYWdlQml0bWFwKHQpfWVsc2UgaWYoZSBpbnN0YW5jZW9mIEJsb2Ipcz1hd2FpdCBjcmVhdGVJbWFnZUJpdG1hcChlKTtlbHNlIGlmKCJzdHJpbmciPT10eXBlb2YgZSl7Y29uc3QgdD1hd2FpdCBmZXRjaChlKSxpPWF3YWl0IHQuYmxvYigpO3M9YXdhaXQgY3JlYXRlSW1hZ2VCaXRtYXAoaSl9ZWxzZSBlIGluc3RhbmNlb2YgSW1hZ2VCaXRtYXAmJihzPWUpO251bGw9PXJ8fHIuY2FjaGVSZXNvdXJjZSh0LHMpLHBvc3RNZXNzYWdlKHtjbWQ6Im9ubG9hZCIsaWQ6dCxzaXplOnt3aWR0aDpzLndpZHRoLGhlaWdodDpzLmhlaWdodH19KX1jYXRjaChzKXtwb3N0TWVzc2FnZSh7Y21kOiJvbmVycm9yIixpZDp0LGVycm9yOihudWxsPT1zP3ZvaWQgMDpzLm1lc3NhZ2UpPz9zfSl9fSh0LmRhdGEuaWQsdC5kYXRhLnNvdXJjZSk7YnJlYWs7Y2FzZSJnZXRSZXNvdXJjZSI6Y29uc3QgZT1udWxsPT1yP3ZvaWQgMDpyLmdldFJlc291cmNlKHQuZGF0YS5pZCk7cG9zdE1lc3NhZ2Uoe2NtZDoib25yZXNvdXJjZSIsaWQ6dC5kYXRhLmlkLGJpdG1hcDplfSk7YnJlYWs7Y2FzZSJkaXNwb3NlUmVzb3VyY2UiOm51bGw9PXJ8fHIuZGlzcG9zZVJlc291cmNlKC4uLnQuZGF0YS5hcmdzKTticmVhaztjYXNlImRpc3Bvc2UiOm51bGw9PXJ8fHIuZGlzcG9zZSgpLG49dm9pZCAwLHI9dm9pZCAwO2JyZWFrO2Nhc2UicmVuZGVyIjppZighcnx8IXQuZGF0YS5jb21tYW5kcylyZXR1cm47Zm9yKGNvbnN0IHMgb2YgdC5kYXRhLmNvbW1hbmRzKXtjb25zdCB0PXMuc2hpZnQoKTtyW3RdKC4uLnMpfXBvc3RNZXNzYWdlKHtjbWQ6Im9ucmVuZGVyIn0pO2JyZWFrO2Nhc2Uic2V0RGltZW5zaW9ucyI6Y2FzZSJzZXRQaXhlbFJhdGlvIjpjYXNlInNldFNtb290aGluZyI6Y2FzZSJjcmVhdGVQYXR0ZXJuIjpyW3QuZGF0YS5jbWRdKC4uLnQuZGF0YS5hcmdzKX19fSgpOwo=",S="undefined"!=typeof window&&window.Blob&&new Blob([atob(L)],{type:"text/javascript;charset=utf-8"});function Y(){let t;try{if(t=S&&(window.URL||window.webkitURL).createObjectURL(S),!t)throw"";return new Worker(t)}catch(e){return new Worker("data:application/javascript;base64,"+L)}finally{t&&(window.URL||window.webkitURL).revokeObjectURL(t)}}class z{constructor(t,e=!1,s=!1){if(this._useW=!1,this._el=t,e&&"function"==typeof this._el.transferControlToOffscreen){this._useW=!0,this._cbs=new Map,this._pl=new p((()=>[]),(t=>{t.length=0})),this._pl.fill(1e3),this._cmds=[];const e=t.transferControlToOffscreen();this._wkr=new Y,this._wkr.postMessage({cmd:"init",canvas:e,debug:s},[e]),this._wkr.onmessage=this.handleMessage.bind(this)}else this._rdr=new C(this._el,s)}loadResource(t,e){return new Promise((async(s,i)=>{if(e instanceof ImageBitmap)this._useW?this.wrappedWorkerLoad(t,e,s,i,!0):(this._rdr.cacheResource(t,e),s({width:e.width,height:e.height}));else if("string"!=typeof e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){const i=await n(e);return this.loadResource(t,i).then((t=>s(t)))}if(e instanceof File)if(this._useW)this.wrappedWorkerLoad(t,e,s,i);else{const h=await r(e);this.wrappedLoad(t,h,s,i)}else e instanceof Blob?this._useW?this.wrappedWorkerLoad(t,e,s,i):this.wrappedLoad(t,e,s,i):i("Unsupported resource type: "+typeof e)}else if(e=e.startsWith("./")?new URL(e,document.baseURI).href:e,this._useW)this.wrappedWorkerLoad(t,e,s,i);else{const h=await l.loadImage(e);this.wrappedLoad(t,h.image,s,i)}}))}getResource(t){return new Promise(((e,s)=>{this._useW?(this._cbs.set(t,{resolve:e,reject:s}),this._wkr.postMessage({cmd:"getResource",id:t})):e(this._rdr.getResource(t))}))}disposeResource(t){this.getBackend("disposeResource",t)}onCommandsReady(){this._useW&&(this._wkr.postMessage({cmd:"render",commands:this._cmds}),this._cmds.length=0,this._pl.reset())}dispose(){this.getBackend("dispose"),setTimeout((()=>{var t,e;null==(t=this._wkr)||t.terminate(),this._wkr=void 0,null==(e=this._cbs)||e.clear()}),50)}handleMessage(t){const{cmd:e,id:s}=t.data;switch(e){default:break;case"onload":if(!this._cbs.has(s))return;this._cbs.get(s).resolve(t.data.size),this._cbs.delete(s);break;case"onerror":if(!this._cbs.has(s))return;this._cbs.get(s).reject(new Error(t.data.error)),this._cbs.delete(s);break;case"onresource":this._cbs.get(s).resolve(t.data.bitmap),this._cbs.delete(s)}}wrappedWorkerLoad(t,e,s,i,h=!1){this._cbs.set(t,{resolve:s,reject:i}),this._wkr.postMessage({cmd:"loadResource",source:e,id:t},h?[e]:[])}async wrappedLoad(t,e,s,i){try{const i=await n(e);this._rdr.cacheResource(t,i),s({width:i.width,height:i.height})}catch(h){i(h)}}setDimensions(t,e){this.getBackend("setDimensions",t,e)}createPattern(t,e){this.getBackend("createPattern",t,e)}setSmoothing(t){this.getBackend("setSmoothing",t)}setPixelRatio(t){this.getBackend("setPixelRatio",t)}save(){this.onDraw("save")}restore(){this.onDraw("restore")}translate(t,e){this.onDraw("translate",t,e)}rotate(t){this.onDraw("rotate",t)}transform(t,e,s,i,h,n){this.onDraw("transform",t,e,s,i,h,n)}scale(t,e){this.onDraw("scale",t,e)}setBlendMode(t){this.onDraw("setBlendMode",t)}setAlpha(t){this.onDraw("setAlpha",t)}drawPath(t,e,s){this.onDraw("drawPath",t,e,s)}clearRect(t,e,s,i,h){this.onDraw("clearRect",t,e,s,i,h)}drawRect(t,e,s,i,h,n,a){this.onDraw("drawRect",t,e,s,i,h,n,a)}drawRoundRect(t,e,s,i,h,n,a,o){this.onDraw("drawRoundRect",t,e,s,i,h,n,a,o)}drawCircle(t,e,s,i="transparent",h,n){this.onDraw("drawCircle",t,e,s,i,h,n)}drawImage(t,e,s,i,h,n){this.onDraw("drawImage",t,e,s,i,h,n)}drawImageCropped(t,e,s,i,h,n,a,o,r,l){this.onDraw("drawImageCropped",t,e,s,i,h,n,a,o,r,l)}drawText(t,e,s,i){this.onDraw("drawText",t,e,s,i)}drawPattern(t,e,s,i,h){this.onDraw("drawPattern",t,e,s,i,h)}onDraw(t,...e){if(this._useW){const s=this._pl.next();return s.length=0,s.push(t,...e),void this._cmds.push(s)}this._rdr[t](...e)}getBackend(t,...e){if(this._useW)return this._wkr.postMessage({cmd:t,args:[...e]});this._rdr[t](...e)}}const H={x:0,y:0};function K(t,e,s,i,h){return(t-e)/(s-e)*(h-i)+i}const k=[],I=[],M=i(1,1,!0).cvs;class F{constructor(t){this._renderer=t,this._cacheMap=new Map}dispose(){this._cacheMap.clear(),this._cacheMap=void 0}getChildrenInArea(t,e,s,i,h,n=!1){const a=[];let o,r,l,d,c,p=t.length;for(;p--;)o=t[p],r=o.getX(),l=o.getY(),d=o.getWidth(),c=o.getHeight(),r<e+i&&r+d>e&&l<s+h&&l+c>s&&(!n||n&&o.collidable)&&a.push(o);return a}pixelCollision(t,e){const s=t.getIntersection(e);if(void 0===s)return;this.getPixelArray(t,s,k),this.getPixelArray(e,s,I);const i=s.width,h=s.height;let n=0;for(let a=0;a<h;++a)for(let t=0;t<i;++t){if(1===k[n]&&1===I[n])return{x:t,y:a};++n}}async cache(t){const e=await this._renderer.getResource(t);if(!e)return!1;const{width:s,height:i}=e;o(M,e,s,i);const{data:h}=M.getContext("2d").getImageData(0,0,s,i),n=new Uint8Array(h.length/4);for(let a=0,o=n.length;a<o;++a){const t=h[4*a+3];n[a]=t<5?0:1}return this._cacheMap.set(t,{mask:n,size:{width:s,height:i}}),M.width=M.height=1,!0}clearCache(t){return!!this.hasCache(t)&&(this._cacheMap.delete(t),!0)}hasCache(t){return this._cacheMap.has(t)}getPixelArray(t,e,s){const i=t.getResourceId();if(!this.hasCache(i))throw new Error(`Cannot get cached entry for resource "${i}". Cache it first.`);const h=t.getBounds(),n=v(e.left-h.left),a=v(e.top-h.top),o=v(e.width),r=v(e.height),{mask:l,size:d}=this._cacheMap.get(i);if(o<=0||r<=0)return void(s.length=0);s.length=v(o*r);const c=d.height,p=d.width,u=n+o,g=a+r;let m=-1,_=0;for(let b=a;b<g;++b)for(let t=n;t<u;++t)_=t>=p||b>=c?0:l[b*p+t],s[++m]=_}}class P{constructor(){this._children=[],this._disposed=!1}addChild(t){if(this.contains(t))return this;const e=this._children.length;return e>0&&(t.last=this._children[e-1],t.last.next=t),t.next=void 0,t.setParent(this),this._children.push(t),this.invalidate(),this}removeChild(t){t.setParent(void 0),t.setCanvas(void 0);const e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1);const s=t.last,i=t.next;return s&&(s.next=i),i&&(i.last=s),t.last=t.next=void 0,this.invalidate(),t}getChildAt(t){return this._children[t]}removeChildAt(t){return this.removeChild(this.getChildAt(t))}numChildren(){return this._children.length}getChildren(){return this._children}contains(t){return t.getParent()===this}invalidate(){}dispose(){this._disposed=!0,this._parent&&this._parent.removeChild(this);let t=this._children.length;for(;t--;){const e=this._children[t];e.dispose(),e.next=void 0,e.last=void 0}this._children=[]}}const{min:V,max:N}=Math,{min:Q,max:J}=Math,B=.5;return t.Canvas=class extends P{constructor({width:t=300,height:e=300,fps:s=60,backgroundColor:i=null,animate:h=!1,smoothing:n=!0,stretchToFit:a=!1,autoSize:o=!0,viewport:r=null,preventEventBubbling:l=!1,parentElement:d=null,debug:c=!1,optimize:p="auto",viewportHandler:u,onUpdate:g,onResize:m}={}){if(super(),this.DEBUG=!1,this.bbox={left:0,top:0,right:0,bottom:0},this._smooth=!1,this._stretch=!1,this._pxr=1,this._prevDef=!1,this._lastRender=0,this._renderId=0,this._renderPending=!1,this._disposed=!1,this._scale={x:1,y:1},this._aTchs=[],this._animate=!1,this._isFs=!1,this._hasFsH=!1,t<=0||e<=0)throw new Error("cannot construct a zCanvas without valid dimensions");this.DEBUG=c,this._el=document.createElement("canvas"),this._rdr=new z(this._el,function(t){if("worker"===t)return!0;const{userAgent:e}=navigator,s=e.includes("Safari")&&!e.includes("Chrome");return"auto"===t&&!s}(p),c),this.collision=new F(this._rdr),this._upHdlr=g,this._renHdlr=this.render.bind(this),this._vpHdlr=u,this._resHdrl=m,this.setFrameRate(s),this.setAnimatable(h),i&&this.setBackgroundColor(i),this._pxr=window.devicePixelRatio||1,this._rdr.setPixelRatio(this._pxr),this.setDimensions(t,e,!0,!0),r&&this.setViewport(r.width,r.height),this._stretch=a,this.setSmoothing(n),this.preventEventBubbling(l),this.addListeners(o),d instanceof HTMLElement&&this.insertInPage(d),requestAnimationFrame((()=>this.handleResize()))}loadResource(t,e){return this._rdr.loadResource(t,e)}getResource(t){return this._rdr.getResource(t)}disposeResource(t){return this._rdr.disposeResource(t)}getRenderer(){return this._rdr}insertInPage(t){if(this._el.parentNode)throw new Error("Canvas already present in DOM");t.appendChild(this._el)}getElement(){return this._el}preventEventBubbling(t){this._prevDef=t}addChild(t){return t.setCanvas(this),super.addChild(t)}invalidate(){this._animate||this._renderPending||(this._renderPending=!0,this._renderId=window.requestAnimationFrame(this._renHdlr))}getFrameRate(){return this._fps}setFrameRate(t){this._fps=t,this._aFps=t,this._rIval=1e3/t}getActualFrameRate(){return this._aFps}getRenderInterval(){return this._rIval}getSmoothing(){return this._smooth}setSmoothing(t){this._rdr.setSmoothing(t),t?this._el.style["image-rendering"]="":["-moz-crisp-edges","-webkit-crisp-edges","pixelated","crisp-edges"].forEach((t=>{this._el.style["image-rendering"]=t})),this._smooth=t,this.invalidate()}getWidth(){return this._qSize?this._qSize.width:this._width}getHeight(){return this._qSize?this._qSize.height:this._height}setDimensions(t,e,s=!0,i=!1){this._qSize={width:t,height:e},s&&(this._prefWidth=t,this._prefHeight=e),i&&this.updateCanvasSize(),this.invalidate()}getViewport(){return this._vp}setViewport(t,e){this._vp||(this._vp={width:t,height:e,left:0,top:0,right:t,bottom:e});const s=this._vp;s.width=t,s.height=e,this.panViewport(Math.min(s.left,t),Math.min(s.top,e))}panViewport(t,e,s=!1){var i;const h=this._vp;h.left=N(0,V(t,this._width-h.width)),h.right=h.left+h.width,h.top=N(0,V(e,this._height-h.height)),h.bottom=h.top+h.height,this.invalidate(),s&&(null==(i=this._vpHdlr)||i.call(this,{type:"panned",value:h}))}setBackgroundColor(t){this._bgColor=t}setAnimatable(t){this._lastRaf=window.performance.now(),t&&!this._renderPending&&this.invalidate(),this._animate=t}isAnimatable(){return this._animate}scale(t,e=t){this._scale={x:t,y:e};const s=1===t&&1===e?"":`scale(${t}, ${e})`,{style:i}=this._el;i["-webkit-transform-origin"]=i["transform-origin"]="0 0",i["-webkit-transform"]=i.transform=s,this.invalidate()}stretchToFit(t){this._stretch=t,this.handleResize()}setFullScreen(t,e=!1){if(e||(e=this._stretch),!this._hasFsH){this._hasFsH=!0;const t=document,s=()=>{this._isFs=t.webkitIsFullScreen||t.mozFullScreen||!0===t.msFullscreenElement,e&&(this._stretch=this._isFs)};["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","MSFullscreenChange"].forEach((e=>{this._hdlr.add(t,e,s)}))}t!==this._isFs&&function(t){let e;e=t.fullscreenElement||t.webkitFullscreenElement?t.exitFullscreen||t.webkitExitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen:t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen,e&&e.call(t)}(this._el)}getCoordinate(){return void 0===this._coords&&(this._coords=this._el.getBoundingClientRect()),this._coords}dispose(){this._disposed||(this._animate=!1,window.cancelAnimationFrame(this._renderId),this.removeListeners(),super.dispose(),this._el.parentNode&&this._el.parentNode.removeChild(this._el),requestAnimationFrame((()=>{this._rdr.dispose(),this._rdr=void 0,this.collision.dispose(),this.collision=void 0})),this._disposed=!0)}handleInteraction(t){const e=this._children.length,s=this._vp;let i;if(e>0)switch(i=this._children[e-1],t.type){default:let h=0,n=0;const a=t.changedTouches;let o=0,r=a.length;const l=1/this._scale.x,d=1/this._scale.y;if(r>0){let{x:c,y:p}=this.getCoordinate();for(s&&(c-=s.left,p-=s.top),o=0;o<r;++o){const s=a[o],{identifier:r}=s;if(h=s.pageX*l-c,n=s.pageY*d-p,"touchstart"===t.type){for(;i;){if(!this._aTchs.includes(i)&&i.handleInteraction(h,n,t)){this._aTchs[r]=i;break}i=i.last}i=this._children[e-1]}else i=this._aTchs[r],(null==i?void 0:i.handleInteraction(h,n,t))&&"touchmove"!==t.type&&(this._aTchs[r]=null)}}break;case"mousedown":case"mousemove":case"mouseup":let{offsetX:c,offsetY:p}=t;if(this._isFs){const e=function(t,e,s,i,h){const n=window.innerHeight/h,a=.5*(window.innerWidth-i*n);return H.x=K(t.clientX-s.left-a,0,i*n,0,e.width),H.y=K(t.clientY-s.top,0,h*n,0,e.height),H}(t,this._el,this.getCoordinate(),this._width,this._height);c=e.x/this._pxr,p=e.y/this._pxr}for(s&&(c+=s.left,p+=s.top);i&&!i.handleInteraction(c,p,t);)i=i.last;break;case"wheel":const{deltaX:u,deltaY:g}=t,m=20,_=0===u?0:u>0?m:-m,b=0===g?0:g>0?m:-m;this.panViewport(s.left+_,s.top+b,!0)}this._prevDef&&(t.stopPropagation(),t.preventDefault()),this._animate||this.invalidate()}render(t=0){this._renderPending=!1;const e=t-this._lastRender;if(this._animate&&e/this._rIval<.999)return this._renderId=window.requestAnimationFrame(this._renHdlr),void(this._lastRaf=t);let s,i;this._aFps=1e3/(t-this._lastRaf),s=this._fps>60?this._fps/this._aFps:60===this._fps&&this._aFps>63?1:1/(this._fps/this._aFps),this._lastRaf=t,this._lastRender=t-e%this._rIval,this._qSize&&this.updateCanvasSize();const h=this._width,n=this._height;this._bgColor?this._rdr.drawRect(0,0,h,n,this._bgColor):this._rdr.clearRect(0,0,h,n);const a="function"==typeof this._upHdlr;for(a&&this._upHdlr(t,s),i=this._children[0];i;)a||i.update(t,s),i.draw(this._rdr,this._vp),i=i.next;this._rdr.onCommandsReady(),!this._disposed&&this._animate&&(this._renderPending=!0,this._renderId=window.requestAnimationFrame(this._renHdlr))}addListeners(t=!1){this._hdlr||(this._hdlr=new e);const s=this._hdlr,i=this.handleInteraction.bind(this),h=this._el;"ontouchstart"in window&&["start","move","end","cancel"].forEach((t=>{s.add(h,`touch${t}`,i)})),["down","move"].forEach((t=>{s.add(h,`mouse${t}`,i)})),s.add(window,"mouseup",i),this._vp&&s.add(h,"wheel",i),t&&s.add(window,"resize",this.handleResize.bind(this))}removeListeners(){var t;null==(t=this._hdlr)||t.dispose(),this._hdlr=void 0}handleResize(){const{innerWidth:t,innerHeight:e}=window;let s=this._prefWidth,i=this._prefHeight,h=1;if(!this._vp&&this._stretch){const{width:n,height:a}=function(t,e,s,i){const h=s/i;let n=t,a=e;return t/e>h?a=t/h:n=e*h,{width:n,height:a}}(s,i,t,e);h=t/n,this.setDimensions(n,a,!1,!0)}else V(s,t),this.setDimensions(s,i,!1),this._vp||s>t&&(h=t/s);this.scale(h)}updateCanvasSize(){var t;const e=this._smooth?this._pxr:1;let s,i;if(void 0!==this._qSize&&(({width:s,height:i}=this._qSize),this._qSize=void 0,this._width=s,this._height=i,this.bbox.right=s,this.bbox.bottom=i),this._vp){const t=this._width,e=this._height;s=V(this._vp.width,t),i=V(this._vp.height,e)}if(s&&i){const h=this.getElement();this._rdr.setDimensions(s*e,i*e),h.style.width=`${s}px`,h.style.height=`${i}px`,null==(t=this._resHdrl)||t.call(this,s,i)}this._rdr.scale(e),this.setSmoothing(this._smooth),this._coords=void 0}},t.Loader=l,t.Sprite=class extends P{constructor({resourceId:t,x:e=0,y:s=0,width:i=10,height:h=10,rotation:n=0,collidable:a=!1,interactive:o=!1,mask:r=!1,sheet:l}){if(super(),this.hover=!1,this.isDragging=!1,this._mask=!1,this._interactive=!1,this._draggable=!1,this._keepInBounds=!1,this._pressed=!1,i<=0||h<=0)throw new Error("cannot construct a Sprite without valid dimensions");if(this.collidable=a,this._mask=r,this._bounds={left:e,top:s,width:i,height:h},r&&this.gdp(),0!==n&&this.setRotation(n),t&&this.setResource(t),l){if(!t)throw new Error("cannot use a spritesheet without a valid resource id");this.setSheet(l,i,h)}this.setInteractive(o)}getDraggable(){return this._draggable}setDraggable(t,e=!1){this._draggable=t,this._keepInBounds=!!this._cstrt||e,t&&!this._interactive&&this.setInteractive(!0)}getInteractive(){return this._interactive}setInteractive(t){this._interactive=t}getX(){return this._bounds.left}setX(t){const e=t-this._bounds.left;if(0===e)return;this._bounds.left=this._cstrt?t+this._cstrt.left:t,this._tfb&&(this._tfb.left+=e);let s=this._children[0];for(;s;)s.isDragging||s.setX(s._bounds.left+e),s=s.next;this.invalidate()}getY(){return this._bounds.top}setY(t){const e=t-this._bounds.top;if(0===e)return;this._bounds.top=this._cstrt?t+this._cstrt.top:t,this._tfb&&(this._tfb.top+=e);let s=this._children[0];for(;s;)s.isDragging||s.setY(s._bounds.top+e),s=s.next;this.invalidate()}getWidth(){return this._bounds.width}setWidth(t){const e=this._bounds.width;e!==t&&(this._bounds.width=t,0!==e&&(this._bounds.left-=t*B-e*B),!this._tfb||0===this.getRotation()&&1===this.getScale()||this.invalidateDrawProps({rotation:this.getRotation(),scale:this.getScale()}),this.invalidate())}getHeight(){return this._bounds.height}setHeight(t){const e=this._bounds.height;e!==t&&(this._bounds.height=t,0!==e&&(this._bounds.top-=t*B-e*B),!this._tfb||0===this.getRotation()&&1===this.getScale()||this.invalidateDrawProps({rotation:this.getRotation(),scale:this.getScale()}),this.invalidate())}setBounds(t,e,s,i){this._cstrt&&(t-=this._cstrt.left,e-=this._cstrt.top);let h=!1;"number"==typeof s&&(h=this._bounds.width!==s,this._bounds.width=s),"number"==typeof i&&(h=h||this._bounds.height!==i,this._bounds.height=i);const n=this._bounds.width,a=this._bounds.height,o=this._cstrt?this._cstrt.width:this.canvas.getWidth(),r=this._cstrt?this._cstrt.height:this.canvas.getHeight();if(this._keepInBounds){const s=Q(0,-(n-o)),i=Q(0,-(a-r)),h=r-a;t=Q(o-n,J(t,s)),e=Q(h,J(e,i))}else t>o&&(t+=n*B),e>r&&(e+=a*B);this.setX(t),this.setY(e),h&&this.invalidate()}getBounds(t=!1){return t&&this._tfb?this._tfb:this._bounds}getRotation(){var t;return(null==(t=this._dp)?void 0:t.rotation)??0}setRotation(t,e){this.invalidateDrawProps({rotation:t%360,pivot:e})}getScale(){var t;return(null==(t=this._dp)?void 0:t.scale)??1}setScale(t){this.invalidateDrawProps({scale:t})}getTransforms(){if(!this._tf){const{scale:t,rotation:e,alpha:s}=this.gdp();this._tf={scale:t,rotation:e,alpha:s}}return this._tf}isVisible(t){return!!this.canvas&&(e=this._tfb||this._bounds,s=t??this.canvas.bbox,({left:_,top:b}=e),_+e.width>=s.left&&_<=s.right&&b+e.height>=s.top&&b<=s.bottom);var e,s}insideBounds(t,e){const{left:s,top:i,width:h,height:n}=this._bounds;return t>=s&&t<=s+h&&e>=i&&e<=i+n}collidesWith(t){if(t===this)return!1;const e=this.getBounds(!0),s=t.getBounds(!0);return!(e.top+e.height<s.top||e.top>s.top+s.height||e.left+e.width<s.left||e.left>s.left+s.width)}getIntersection(t){if(this.collidesWith(t)){const e=this._bounds,s=t.getBounds(),i=J(e.left,s.left),h=J(e.top,s.top);return{left:i,top:h,width:Q(e.left+e.width,s.width+s.height)-i,height:Q(e.top+e.height,s.top+s.height)-h}}}collidesWithEdge(t,e){if(t===this)return!1;if(isNaN(e)||e<0||e>3)throw new Error("invalid argument for edge");switch(e){case 0:return this.getX()<=t.getX()+t.getWidth();case 1:return this.getY()<=t.getY()+t.getHeight();case 2:return this.getX()+this.getWidth()<=t.getX();case 3:return this.getY()+this.getHeight()>=t.getY()}return!1}setResource(t,e,s){this._resourceId=t,"number"==typeof e&&this.setWidth(e),"number"==typeof s&&this.setHeight(s),this.invalidate()}getResourceId(){return this._resourceId}setSheet(t,e,s){this._sheet=t,t?(this._animation={type:null,col:0,maxCol:0,fpt:0,counter:0,tileWidth:e??this.getWidth(),tileHeight:s??this.getHeight()},this.switchAnimation(0)):this._animation=void 0}switchAnimation(t){const e=this._animation,s=this._sheet[t];e.type=s,e.fpt=s.fpt,e.maxCol=s.col+(s.amount-1),e.col=s.col,e.counter=0,e.onComplete=s.onComplete}setParent(t){this._parent=t}getParent(){return this._parent}setCanvas(t){this.canvas=t;for(const e of this._children)e.setCanvas(t)}setConstraint(t,e,s,i){return this._cstrt={left:t,top:e,width:s,height:i},this._bounds.left=J(t,this._bounds.left),this._bounds.top=J(e,this._bounds.top),this._keepInBounds=!0,this.getConstraint()}getConstraint(){return this._cstrt}addChild(t){return t.setCanvas(this.canvas),super.addChild(t)}update(t,e){let s=this._children[0];for(;s;)s.update(t,e),s=s.next;this._animation&&this.updateAnimation(e)}draw(t,e){const s=this._bounds;if(this._resourceId&&this.isVisible(e)){const i=this._animation;let{left:h,top:n,width:a,height:o}=s;if(i){const s=i.tileWidth?i.tileWidth:B+a<<0,r=i.tileHeight?i.tileHeight:B+o<<0;e&&(h-=e.left,n-=e.top),t.drawImageCropped(this._resourceId,i.col*s,i.type.row*r,s,r,h,n,a,o,this.getDrawProps())}else if(e){const{src:i,dest:h}=function(t,e){({left:_,top:b,width:w,height:f}=t);const{left:s,top:i,width:h,height:n}=e;return w=_>s?u(w,h-(_-s)):u(h,w-(s-_)),f=b>i?u(f,n-(b-i)):u(n,f-(i-b)),{src:{left:_>s?0:s-_,top:b>i?0:i-b,width:w,height:f},dest:{left:_>s?_-s:0,top:b>i?b-i:0,width:w,height:f}}}(s,e);t.drawImageCropped(this._resourceId,i.left,i.top,i.width,i.height,h.left,h.top,h.width,h.height,this.getDrawProps())}else t.drawImage(this._resourceId,h,n,a,o,this.getDrawProps())}let i=this._children[0];for(;i;)i.draw(t,e),i=i.next}dispose(){this._disposed||super.dispose()}getDrawProps(){if(this._tf){const{alpha:t,rotation:e,scale:s}=this._tf;(this._dp.alpha!==t||this._dp.rotation!==e||this._dp.scale!==s)&&this.invalidateDrawProps({rotation:e,alpha:t,scale:s})}return this._dp}handlePress(t,e,s){}handleRelease(t,e,s){}handleClick(){}handleMove(t,e,s){const i=this._dro.x+(t-this._drc.x),h=this._dro.y+(e-this._drc.y);this.setBounds(i,h,this._bounds.width,this._bounds.height)}handleInteraction(t,e,s){let i;const h=this._children.length;if(h>0)for(i=this._children[h-1];i;){if(i.handleInteraction(t,e,s))return!0;i=i.last}if(!this._interactive)return!1;const{type:n}=s;if(this._pressed&&("touchend"===n||"mouseup"===n))return this._pressed=!1,this.isDragging&&(this.isDragging=!1),window.performance.now()-this._pTime<250&&this.handleClick(),this.handleRelease(t,e,s),!0;if(this.insideBounds(t,e)){if(this.hover=!0,"touchstart"===n||"mousedown"===n)return this._pTime=window.performance.now(),this._pressed=!0,this._draggable&&(this.isDragging=!0,this._dro={x:this._bounds.left,y:this._bounds.top},this._drc={x:t,y:e}),this.handlePress(t,e,s),"touchstart"===n&&(s.stopPropagation(),s.preventDefault()),!0}else this.hover=!1;return!!this.isDragging&&(this.handleMove(t,e,s),!0)}invalidate(){var t;null==(t=this.canvas)||t.invalidate()}invalidateDrawProps({alpha:t,scale:e,rotation:s,pivot:i}){const h=this.gdp();h.alpha=t??h.alpha,h.scale=e??h.scale,h.rotation=s??h.rotation,h.pivot=i??h.pivot,void 0===s&&void 0===e||(this._tfb||(this._tfb={...this._bounds}),function(t,e,s,i){if(0===e&&1===s)return G(t,1,i);const{left:h,top:n,width:a,height:o}=G(t,s,i);if(0!==e){const t=-a*m,s=a*m,r=a*m,l=-a*m,d=o*m,c=o*m,p=-o*m,_=-o*m,b=e*Z,w=Math.cos(b),f=Math.sin(b),v=t*w+d*f,G=-t*f+d*w,y=s*w+c*f,x=-s*f+c*w,R=r*w+p*f,X=-r*f+p*w,W=l*w+_*f,C=-l*f+_*w,L=u(v,y,R,W),S=g(v,y,R,W),Y=u(G,x,X,C),z=g(G,x,X,C);i.width=S-L,i.height=z-Y,i.left=h-(i.width*m-a*m),i.top=n-(i.height*m-o*m)}}(this._bounds,h.rotation,h.scale,this._tfb))}updateAnimation(t=1){const e=this._animation;e.counter+=t,e.counter>=e.fpt&&(++e.col,e.counter=e.counter%e.fpt),e.col>e.maxCol&&(e.col=e.type.col,"function"==typeof e.onComplete&&e.onComplete(this))}gdp(){return this._dp=this._dp||{alpha:1,blendMode:this._mask?"destination-in":void 0,safeMode:!1,scale:1,rotation:0},this._dp}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t}({});
